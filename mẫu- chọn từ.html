<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Chọn Từ Đúng</title>
    <!-- Bootstrap 5 CSS for responsive design and components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts for 'Open Sans' typography -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons (e.g., check/times circles) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f0f2f5;
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Headings */
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9;
            border-left: 6px solid #4CAF50;
            padding: 20px 25px;
            border-radius: 10px;
            color: #388e3c;
        }

        /* Styling for each exercise question */
        .question-item {
            margin-bottom: 30px; /* Increased margin for better separation */
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .question-item .question-text {
            font-size: 1.1em;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 15px;
            display: flex;
            align-items: center; /* Align content */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 5px; /* Space between words */
        }

        /* Styling for clickable word options */
        .question-item .word-option {
            cursor: pointer;
            padding: 2px 5px;
            border-bottom: 1px dashed #ced4da; /* Subtle underline */
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            user-select: none; /* Prevent text selection on double click */
            display: inline-block; /* Ensure padding/margin works */
        }
        .question-item .word-option:hover {
            background-color: #e9ecef;
            border-color: #a7aeb4;
        }
        .question-item .word-option.selected {
            background-color: #d1e7dd; /* Light green for selected */
            border-color: #198754; /* Green underline */
            color: #198754;
            font-weight: 700;
        }
        /* Feedback styles after submission */
        .question-item .word-option.is-correct {
            background-color: #d1e7dd; /* Green background */
            border-color: #198754; /* Green underline */
            color: #198754;
            font-weight: 700;
        }
        .question-item .word-option.is-incorrect {
            background-color: #f8d7da; /* Red background */
            border-color: #dc3545; /* Red underline */
            color: #dc3545;
            font-weight: 700;
        }
        /* Style for correct answer when user chose incorrectly */
        .question-item .word-option.correct-but-not-selected {
            background-color: #e6f7ff; /* Light blue */
            border-color: #007bff; /* Blue underline */
            color: #007bff;
            font-weight: 700;
        }


        /* Feedback icons */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            vertical-align: middle;
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        /* Score display color coding */
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .question-text-solution {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .question-item {
                padding: 15px;
                margin-bottom: 20px;
            }
            .question-item .question-text {
                font-size: 1em;
                margin-bottom: 10px;
            }
            .question-item .word-option {
                padding: 1px 3px;
            }
            .buttons .btn {
                font-size: 1.1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.3em;
                padding: 12px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Chọn Từ Đúng</h1>
        </div>
        <h2>Khoanh tròn từ đúng.</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Circle the correct word.
            <br>
            <strong>Hướng dẫn:</strong> Nhấn vào từ đúng trong câu.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <form id="circleTheWordForm">
            <div class="question-item" data-question-id="q1">
                <p class="question-text">
                    1. I <span class="word-option" data-option-value="search">search</span> / <span class="word-option" data-option-value="wonder">wonder</span> how difficult the maths test tomorrow will be.
                </p>
                <i class="feedback-icon fa-solid" id="icon1"></i>
            </div>

            <div class="question-item" data-question-id="q2">
                <p class="question-text">
                    2. It's nearly the end of <span class="word-option" data-option-value="term">term</span> / <span class="word-option" data-option-value="mark">mark</span>, so it will be the holidays soon!
                </p>
                <i class="feedback-icon fa-solid" id="icon2"></i>
            </div>

            <div class="question-item" data-question-id="q3">
                <p class="question-text">
                    3. Could you <span class="word-option" data-option-value="revise">revise</span> / <span class="word-option" data-option-value="remember">remember</span> me to take this book back to the library?
                </p>
                <i class="feedback-icon fa-solid" id="icon3"></i>
            </div>

            <div class="question-item" data-question-id="q4">
                <p class="question-text">
                    4. Carl is a computer <span class="word-option" data-option-value="brain">brain</span> / <span class="word-option" data-option-value="expert">expert</span>. Why don't you ask him to fix your computer?
                </p>
                <i class="feedback-icon fa-solid" id="icon4"></i>
            </div>

            <div class="question-item" data-question-id="q5">
                <p class="question-text">
                    5. Rosalind is a really <span class="word-option" data-option-value="smart">smart</span> / <span class="word-option" data-option-value="talented">talented</span> musician, but she doesn't practise enough.
                </p>
                <i class="feedback-icon fa-solid" id="icon5"></i>
            </div>

            <div class="question-item" data-question-id="q6">
                <p class="question-text">
                    6. Rebecca is really <span class="word-option" data-option-value="clever">clever</span> / <span class="word-option" data-option-value="mental">mental</span>. She always knows the answer!
                </p>
                <i class="feedback-icon fa-solid" id="icon6"></i>
            </div>

            <div class="question-item" data-question-id="q7">
                <p class="question-text">
                    7. I wasn't sure of the answer so I <span class="word-option" data-option-value="guessed">guessed</span> / <span class="word-option" data-option-value="hesitated">hesitated</span> and I was right!
                </p>
                <i class="feedback-icon fa-solid" id="icon7"></i>
            </div>

            <div class="question-item" data-question-id="q8">
                <p class="question-text">
                    8. Have you ever <span class="word-option" data-option-value="concentrated">concentrated</span> / <span class="word-option" data-option-value="considered">considered</span> becoming a professional singer?
                </p>
                <i class="feedback-icon fa-solid" id="icon8"></i>
            </div>

            <div class="question-item" data-question-id="q9">
                <p class="question-text">
                    9. After every experiment in chemistry, we have to write a <span class="word-option" data-option-value="subject">subject</span> / <span class="word-option" data-option-value="report">report</span> on what happened.
                </p>
                <i class="feedback-icon fa-solid" id="icon9"></i>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JavaScript bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, full sentences, explanations, and translations for each question.
        const questionsData = {
            'q1': {
                question_text: 'I {option1} / {option2} how difficult the maths test tomorrow will be.',
                options: {
                    'search': { text: 'search', correct: false },
                    'wonder': { text: 'wonder', correct: true }
                },
                correct_option_value: 'wonder',
                fullSentence: 'I wonder how difficult the maths test tomorrow will be.',
                translation: 'Tôi tự hỏi bài kiểm tra toán ngày mai sẽ khó đến mức nào.',
                explanation: '"Wonder" (tự hỏi) có nghĩa là muốn biết điều gì đó. "Search" (tìm kiếm) không phù hợp trong ngữ cảnh này.',
                grammar_note: 'Sử dụng "wonder" khi bạn muốn biết hoặc suy nghĩ về điều gì đó.'
            },
            'q2': {
                question_text: 'It\'s nearly the end of {option1} / {option2}, so it will be the holidays soon!',
                options: {
                    'term': { text: 'term', correct: true },
                    'mark': { text: 'mark', correct: false }
                },
                correct_option_value: 'term',
                fullSentence: 'It\'s nearly the end of term, so it will be the holidays soon!',
                translation: 'Sắp hết học kỳ rồi, nên sẽ sớm đến kỳ nghỉ thôi!',
                explanation: '"Term" (học kỳ) là khoảng thời gian học tập trong năm học. "Mark" (điểm số) không phù hợp với ngữ cảnh "end of... so it will be the holidays".',
                grammar_note: '"Term" dùng để chỉ một học kỳ hoặc quý trong năm học.'
            },
            'q3': {
                question_text: 'Could you {option1} / {option2} me to take this book back to the library?',
                options: {
                    'revise': { text: 'revise', correct: false },
                    'remember': { text: 'remember', correct: true }
                },
                correct_option_value: 'remember',
                fullSentence: 'Could you remember me to take this book back to the library?',
                translation: 'Bạn có thể nhắc tôi mang cuốn sách này trả lại thư viện không?',
                explanation: '"Remember" (nhắc nhở) có nghĩa là giúp ai đó nhớ một điều gì đó. "Revise" (ôn tập) không phù hợp trong ngữ cảnh này.',
                grammar_note: 'Cấu trúc "remember someone to do something" có nghĩa là nhắc nhở ai đó làm gì.'
            },
            'q4': {
                question_text: 'Carl is a computer {option1} / {option2}. Why don\'t you ask him to fix your computer?',
                options: {
                    'brain': { text: 'brain', correct: false },
                    'expert': { text: 'expert', correct: true }
                },
                correct_option_value: 'expert',
                fullSentence: 'Carl is a computer expert. Why don\'t you ask him to fix your computer?',
                translation: 'Carl là một chuyên gia máy tính. Sao bạn không nhờ anh ấy sửa máy tính cho bạn?',
                explanation: '"Expert" (chuyên gia) là người có kiến thức hoặc kỹ năng chuyên sâu trong một lĩnh vực cụ thể. "Brain" (não) không phù hợp trong ngữ cảnh này.',
                grammar_note: '"Expert" là danh từ để chỉ người có chuyên môn cao.'
            },
            'q5': {
                question_text: 'Rosalind is a really {option1} / {option2} musician, but she doesn\'t practise enough.',
                options: {
                    'smart': { text: 'smart', correct: false },
                    'talented': { text: 'talented', correct: true }
                },
                correct_option_value: 'talented',
                fullSentence: 'Rosalind is a really talented musician, but she doesn\'t practise enough.',
                translation: 'Rosalind là một nhạc sĩ thực sự tài năng, nhưng cô ấy không luyện tập đủ.',
                explanation: '"Talented" (tài năng) dùng để mô tả người có khả năng tự nhiên làm tốt điều gì đó, đặc biệt là trong nghệ thuật. "Smart" (thông minh) có thể dùng cho người, nhưng "talented" phù hợp hơn với ngữ cảnh "musician".',
                grammar_note: '"Talented" thường đi kèm với các lĩnh vực nghệ thuật, thể thao.'
            },
            'q6': {
                question_text: 'Rebecca is really {option1} / {option2}. She always knows the answer!',
                options: {
                    'clever': { text: 'clever', correct: true },
                    'mental': { text: 'mental', correct: false }
                },
                correct_option_value: 'clever',
                fullSentence: 'Rebecca is really clever. She always knows the answer!',
                translation: 'Rebecca thực sự thông minh. Cô ấy luôn biết câu trả lời!',
                explanation: '"Clever" (thông minh, lanh lợi) là tính từ phù hợp để mô tả người có khả năng học hỏi và hiểu nhanh. "Mental" (thuộc về tinh thần) không phù hợp trong ngữ cảnh này.',
                grammar_note: '"Clever" dùng để khen ngợi trí thông minh, sự nhanh nhạy.'
            },
            'q7': {
                question_text: 'I wasn\'t sure of the answer so I {option1} / {option2} and I was right!',
                options: {
                    'guessed': { text: 'guessed', correct: true },
                    'hesitated': { text: 'hesitated', correct: false }
                },
                correct_option_value: 'guessed',
                fullSentence: 'I wasn\'t sure of the answer so I guessed and I was right!',
                translation: 'Tôi không chắc câu trả lời nên tôi đã đoán và tôi đã đúng!',
                explanation: '"Guessed" (đoán) có nghĩa là đưa ra câu trả lời mà không chắc chắn. Ngữ cảnh "I was right!" cho thấy việc đoán đã thành công. "Hesitated" (do dự) không phù hợp.',
                grammar_note: '"Guess" là hành động đưa ra một phỏng đoán.'
            },
            'q8': {
                question_text: 'Have you ever {option1} / {option2} becoming a professional singer?',
                options: {
                    'concentrated': { text: 'concentrated', correct: false },
                    'considered': { text: 'considered', correct: true }
                },
                correct_option_value: 'considered',
                fullSentence: 'Have you ever considered becoming a professional singer?',
                translation: 'Bạn đã bao giờ cân nhắc trở thành một ca sĩ chuyên nghiệp chưa?',
                explanation: '"Considered" (cân nhắc) có nghĩa là suy nghĩ về điều gì đó một cách cẩn thận. "Concentrated" (tập trung) không phù hợp trong ngữ cảnh này.',
                grammar_note: 'Cấu trúc: "consider + V-ing" (cân nhắc làm gì).'
            },
            'q9': {
                question_text: 'After every experiment in chemistry, we have to write a {option1} / {option2} on what happened.',
                options: {
                    'subject': { text: 'subject', correct: false },
                    'report': { text: 'report', correct: true }
                },
                correct_option_value: 'report',
                fullSentence: 'After every experiment in chemistry, we have to write a report on what happened.',
                translation: 'Sau mỗi thí nghiệm hóa học, chúng tôi phải viết một báo cáo về những gì đã xảy ra.',
                explanation: '"Report" (báo cáo) là một tài liệu mô tả kết quả hoặc chi tiết của một sự kiện, thí nghiệm. "Subject" (chủ đề) không phù hợp trong ngữ cảnh này.',
                grammar_note: '"Report" là danh từ để chỉ một bản báo cáo, tường trình.'
            }
        };

        // Event listener for word options
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.word-option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionItem = this.closest('.question-item');
                    // Remove 'selected' class from all options within the same question
                    questionItem.querySelectorAll('.word-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Add 'selected' class to the clicked option
                    this.classList.add('selected');
                });
            });
        });

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question
            Object.keys(questionsData).forEach(qId => {
                const questionInfo = questionsData[qId];
                const questionItem = document.querySelector(`[data-question-id="${qId}"]`);
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`);
                const allOptions = questionItem.querySelectorAll('.word-option');

                let isCorrect = false;
                let selectedOptionValue = null;

                // Reset all option styles first
                allOptions.forEach(option => {
                    option.classList.remove('selected', 'is-correct', 'is-incorrect', 'correct-but-not-selected');
                });

                const selectedOption = questionItem.querySelector('.word-option.selected');

                if (selectedOption) {
                    selectedOptionValue = selectedOption.dataset.optionValue;
                    if (selectedOptionValue.toLowerCase() === questionInfo.correct_option_value.toLowerCase()) {
                        isCorrect = true;
                        score++;
                        selectedOption.classList.add('is-correct');
                    } else {
                        selectedOption.classList.add('is-incorrect');
                        // Highlight the correct answer if the user chose incorrectly
                        questionItem.querySelector(`[data-option-value="${questionInfo.correct_option_value}"]`).classList.add('correct-but-not-selected');
                    }
                } else {
                    // If no option was selected, it's incorrect. Highlight the correct one.
                    questionItem.querySelector(`[data-option-value="${questionInfo.correct_option_value}"]`).classList.add('correct-but-not-selected');
                }

                // Show feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                // Add detailed solution
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1);
                const questionTextSolutionDiv = document.createElement('div');
                questionTextSolutionDiv.classList.add('question-text-solution');

                // Replace placeholders with correct option for solution display
                let fullTextHtml = questionInfo.question_text
                    .replace('{option1}', `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[0]].text}</span>`)
                    .replace('{option2}', `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[1]].text}</span>`);

                // Adjust to highlight only the truly correct one in the solution
                fullTextHtml = `${questionNumber}. ${questionInfo.question_text.replace(questionInfo.options[Object.keys(questionInfo.options)[0]].text, `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[0]].text}</span>`).replace(questionInfo.options[Object.keys(questionInfo.options)[1]].text, `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[1]].text}</span>`)}`;

                // A more precise way to display the solution text, highlighting only the correct word
                let solutionSentence = questionInfo.question_text;
                solutionSentence = solutionSentence.replace(new RegExp(`\\b${questionInfo.options[Object.keys(questionInfo.options)[0]].text}\\b`, 'g'), `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[0]].text}</span>`);
                solutionSentence = solutionSentence.replace(new RegExp(`\\b${questionInfo.options[Object.keys(questionInfo.options)[1]].text}\\b`, 'g'), `<span class="correct-answer-text">${questionInfo.options[Object.keys(questionInfo.options)[1]].text}</span>`);
                solutionSentence = solutionSentence.replace(' / ', ' / '); // Keep the slash
                
                // Now replace the correct one with the highlighted version
                solutionSentence = solutionSentence.replace(`<span class="correct-answer-text">${questionInfo.correct_option_value}</span>`, `<span class="correct-answer-text">${questionInfo.correct_option_value}</span>`);
                
                questionTextSolutionDiv.innerHTML = `${questionNumber}. ${questionInfo.fullSentence.replace(questionInfo.correct_option_value, `<span class="correct-answer-text">${questionInfo.correct_option_value}</span>`)}`;

                solutionItem.appendChild(questionTextSolutionDiv);

                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${questionInfo.explanation}<br>${questionInfo.grammar_note}`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch:</strong> ${questionInfo.translation}`;
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing selections, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const wordOptions = document.querySelectorAll('.word-option');
            wordOptions.forEach(option => {
                option.classList.remove('selected', 'is-correct', 'is-incorrect', 'correct-but-not-selected'); // Remove all feedback classes
            });

            const feedbackIcons = document.querySelectorAll('.feedback-icon');
            feedbackIcons.forEach(icon => {
                icon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                icon.style.display = 'none'; // Hide feedback icon
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>
