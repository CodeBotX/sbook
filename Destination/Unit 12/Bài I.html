<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Đổi Từ Trong Câu - Dạng C</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f0f2f5;
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Headings */
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9;
            border-left: 6px solid #4CAF50;
            padding: 20px 25px;
            border-radius: 10px;
            color: #388e3c;
        }

        /* Styling for each exercise question */
        .question-item {
            margin-bottom: 25px; /* Spacing between questions */
            display: flex;
            align-items: baseline; /* Align input with text baseline */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .question-item .question-number {
            font-weight: 700;
            margin-right: 10px;
            color: #007bff;
            font-size: 1.1em;
            flex-shrink: 0; /* Prevent number from shrinking */
        }
        .question-item .question-text {
            font-size: 1.05em;
            color: #34495e;
            flex-grow: 1; /* Allow text to take available space */
            display: flex; /* Use flex to align input and original bold word */
            align-items: baseline;
            flex-wrap: wrap; /* Allow wrapping within the text itself */
            line-height: 1.5;
        }
        .question-item .wrong-word-placeholder {
            font-weight: bold;
            color: #dc3545; /* Highlight wrong word in red */
            text-decoration: line-through; /* Strikethrough wrong word */
            margin-right: 5px; /* Space before input */
        }
        .question-item input[type="text"] {
            display: inline-block;
            width: 180px; /* Adjust width as needed */
            margin: 0 8px; /* Space around the input */
            padding: 5px 10px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .question-item input[type="text"]:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
        }
        /* Styles for correct and incorrect input feedback */
        .question-item input[type="text"].is-correct {
            border-color: #198754;
            box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
        }
        .question-item input[type="text"].is-incorrect {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
        }

        /* Feedback icons */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            vertical-align: middle;
            flex-shrink: 0; /* Prevent icon from shrinking */
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        /* Score display color coding */
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .question-text-solution {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .original-wrong-word {
            color: #dc3545; /* Original wrong word in red */
            text-decoration: line-through; /* Strikethrough */
            font-weight: normal; /* Override bold from solution-item */
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .question-item {
                flex-direction: column; /* Stack items vertically */
                align-items: flex-start; /* Align text to left */
                margin-bottom: 20px;
            }
            .question-item .question-number {
                margin-bottom: 5px;
            }
            .question-item .question-text {
                width: 100%; /* Full width for text */
                flex-direction: column; /* Stack parts of the sentence */
                align-items: flex-start;
            }
            .question-item input[type="text"] {
                width: 100%; /* Full width for inputs */
                margin: 5px 0; /* Adjust margin */
            }
            .feedback-icon {
                margin-left: 0; /* Remove left margin */
                margin-top: 5px; /* Add space below input */
                width: 100%; /* Take full width */
                text-align: right; /* Align icon to the right */
            }
            .buttons .btn {
                font-size: 1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.2em;
                padding: 10px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Sửa Lỗi Từ Vựng</h1>
        </div>
        <h2>Mỗi từ in đậm nằm trong câu sai. Viết lại từ đúng.</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Each of the words in bold is in the wrong sentence. Write the correct word.
            <br>
            <strong>Hướng dẫn:</strong> Mỗi từ in đậm trong câu là sai. Hãy viết lại từ đúng vào chỗ trống tương ứng.
            <br>
            <span class="text-muted">(Lưu ý: Bạn cần tìm từ đúng từ các từ in đậm bị đặt sai chỗ trong bài. Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <form id="swapWordsForm">
            <div class="mb-4">
                <div class="question-item">
                    <span class="question-number">1.</span>
                    <p class="question-text">
                        I was first <span class="wrong-word-placeholder">respected</span> to Jake at a party.
                        <input type="text" id="q1" name="q1" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon1"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">2.</span>
                    <p class="question-text">
                        I shouldn't have <span class="wrong-word-placeholder">rented</span> you. Now I know you can't keep a secret!
                        <input type="text" id="q2" name="q2" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon2"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">3.</span>
                    <p class="question-text">
                        Our house is being <span class="wrong-word-placeholder">recognised</span> so we're staying with my grandparents at the moment.
                        <input type="text" id="q3" name="q3" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon3"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">4.</span>
                    <p class="question-text">
                        Everyone <span class="wrong-word-placeholder">apologised</span> Mr Turner because he was strict but fair.
                        <input type="text" id="q4" name="q4" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon4"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">5.</span>
                    <p class="question-text">
                        Have you <span class="wrong-word-placeholder">introduced</span> to Kelly for losing her CD?
                        <input type="text" id="q5" name="q5" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon5"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">6.</span>
                    <p class="question-text">
                        Sarah said I was a liar but Carol <span class="wrong-word-placeholder">trusted</span> me and said I wasn't.
                        <input type="text" id="q6" name="q6" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon6"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">7.</span>
                    <p class="question-text">
                        We <span class="wrong-word-placeholder">decorated</span> a small house in the countryside for the summer.
                        <input type="text" id="q7" name="q7" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon7"></i>
                </div>

                <div class="question-item">
                    <span class="question-number">8.</span>
                    <p class="question-text">
                        No one <span class="wrong-word-placeholder">defended</span> Phil when he came to the party dressed as an old man.
                        <input type="text" id="q8" name="q8" class="form-control">
                    </p>
                    <i class="feedback-icon fa-solid" id="icon8"></i>
                </div>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra ✨</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại 🔄</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, full sentences, explanations, and translations for each question.
        // Also list all the "wrong" words that are provided in the exercise for clarity.
        const allWrongWords = [
            'respected', 'rented', 'recognised', 'apologised',
            'introduced', 'trusted', 'decorated', 'defended'
        ].map(word => word.toLowerCase());

        const questionsData = {
            'q1': {
                original_wrong_word: 'respected',
                correct_answer: 'introduced',
                fullSentence: 'I was first <span class="original-wrong-word">respected</span> **introduced** to Jake at a party.',
                translation: 'Tôi lần đầu tiên được giới thiệu với Jake tại một bữa tiệc.',
                explanation: 'Động từ "introduce" (giới thiệu) phù hợp với ngữ cảnh "được giới thiệu với ai đó tại một bữa tiệc". "Respected" (tôn trọng) không hợp nghĩa.',
                grammar_note: 'Cấu trúc "be introduced to someone" (được giới thiệu với ai đó).'
            },
            'q2': {
                original_wrong_word: 'rented',
                correct_answer: 'trusted',
                fullSentence: "I shouldn't have <span class=\"original-wrong-word\">rented</span> **trusted** you. Now I know you can't keep a secret!",
                translation: 'Lẽ ra tôi không nên tin tưởng bạn. Bây giờ tôi biết bạn không thể giữ bí mật!',
                explanation: 'Việc không thể giữ bí mật cho thấy người nói không nên "tin tưởng" người kia. "Trusted" (tin tưởng) là từ đúng. "Rented" (thuê) không liên quan.',
                grammar_note: 'Động từ "trust" (tin tưởng).'
            },
            'q3': {
                original_wrong_word: 'recognised',
                correct_answer: 'decorated',
                fullSentence: "Our house is being <span class=\"original-wrong-word\">recognised</span> **decorated** so we're staying with my grandparents at the moment.",
                translation: 'Nhà của chúng tôi đang được trang trí nên chúng tôi đang ở với ông bà vào lúc này.',
                explanation: 'Nếu đang ở nhà ông bà, có khả năng nhà đang được sửa chữa hoặc "trang trí". "Decorated" (trang trí) phù hợp. "Recognised" (nhận ra) không hợp nghĩa.',
                grammar_note: 'Cấu trúc bị động "is being + V-ing" (đang được làm gì).'
            },
            'q4': {
                original_wrong_word: 'apologised',
                correct_answer: 'respected',
                fullSentence: "Everyone <span class=\"original-wrong-word\">apologised</span> **respected** Mr Turner because he was strict but fair.",
                translation: 'Mọi người tôn trọng ông Turner vì ông ấy nghiêm khắc nhưng công bằng.',
                explanation: 'Tính cách "strict but fair" (nghiêm khắc nhưng công bằng) gợi ý rằng mọi người sẽ "tôn trọng" ông Turner. "Respected" (tôn trọng) là từ đúng. "Apologised" (xin lỗi) không hợp nghĩa.',
                grammar_note: 'Động từ "respect" (tôn trọng).'
            },
            'q5': {
                original_wrong_word: 'introduced',
                correct_answer: 'apologised',
                fullSentence: "Have you <span class=\"original-wrong-word\">introduced</span> **apologised** to Kelly for losing her CD?",
                translation: 'Bạn đã xin lỗi Kelly vì làm mất đĩa CD của cô ấy chưa?',
                explanation: 'Hành động làm mất đĩa CD cần một lời "xin lỗi". "Apologised" (xin lỗi) là từ đúng. "Introduced" (giới thiệu) không hợp nghĩa.',
                grammar_note: 'Cấu trúc "apologise to someone for something" (xin lỗi ai đó vì điều gì).'
            },
            'q6': {
                original_wrong_word: 'trusted',
                correct_answer: 'defended',
                fullSentence: "Sarah said I was a liar but Carol <span class=\"original-wrong-word\">trusted</span> **defended** me and said I wasn't.",
                translation: 'Sarah nói tôi là kẻ nói dối nhưng Carol đã bảo vệ tôi và nói tôi không phải.',
                explanation: 'Đối lập với việc bị gọi là "liar" (kẻ nói dối), Carol đã "bảo vệ" (defended) người nói. "Trusted" (tin tưởng) không phù hợp trong ngữ cảnh này.',
                grammar_note: 'Động từ "defend" (bảo vệ).'
            },
            'q7': {
                original_wrong_word: 'decorated',
                correct_answer: 'rented',
                fullSentence: "We <span class=\"original-wrong-word\">decorated</span> **rented** a small house in the countryside for the summer.",
                translation: 'Chúng tôi đã thuê một căn nhà nhỏ ở vùng nông thôn vào mùa hè.',
                explanation: 'Việc ở một ngôi nhà "for the summer" (trong mùa hè) thường là "thuê" (rented) chứ không phải mua hay tự trang trí. "Decorated" (trang trí) không hợp lý bằng.',
                grammar_note: 'Động từ "rent" (thuê).'
            },
            'q8': {
                original_wrong_word: 'defended',
                correct_answer: 'recognised',
                fullSentence: "No one <span class=\"original-wrong-word\">defended</span> **recognised** Phil when he came to the party dressed as an old man.",
                translation: 'Không ai nhận ra Phil khi anh ấy đến bữa tiệc trong trang phục một ông già.',
                explanation: 'Nếu Phil "dressed as an old man" (mặc đồ như một ông già), thì mọi người có thể không "nhận ra" anh ấy. "Recognised" (nhận ra) là từ đúng. "Defended" (bảo vệ) không hợp nghĩa.',
                grammar_note: 'Động từ "recognise" (nhận ra).'
            }
        };

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question
            Object.keys(questionsData).forEach(qId => {
                const questionInfo = questionsData[qId];
                const inputElement = document.getElementById(qId);
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`);

                // Reset feedback classes
                inputElement.classList.remove('is-correct', 'is-incorrect');

                const userAnswer = inputElement.value.trim().toLowerCase();
                const correctAnswer = questionInfo.correct_answer.toLowerCase();

                let isCorrect = false;
                if (userAnswer === correctAnswer) {
                    isCorrect = true;
                    score++;
                    inputElement.classList.add('is-correct');
                } else {
                    inputElement.classList.add('is-incorrect');
                }

                // Show feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                // Add detailed solution
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1);
                const questionTextSolutionDiv = document.createElement('div');
                questionTextSolutionDiv.classList.add('question-text-solution');

                // Reconstruct the sentence with the correct answer, bolding and underlining it,
                // and showing the original wrong word with strikethrough.
                const fullTextHtml = `${questionNumber}. ${questionInfo.fullSentence.replace(`**${questionInfo.correct_answer}**`, `<span class="correct-answer-text">${questionInfo.correct_answer}</span>`)}`;
                questionTextSolutionDiv.innerHTML = fullTextHtml;
                solutionItem.appendChild(questionTextSolutionDiv);

                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${questionInfo.explanation}<br><em>${questionInfo.grammar_note}</em>`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch:</strong> ${questionInfo.translation}`;
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing input fields, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const textInputs = document.querySelectorAll('input[type="text"]');
            textInputs.forEach(input => {
                input.value = ''; // Clear text input
                input.classList.remove('is-correct', 'is-incorrect'); // Remove feedback classes
            });

            const feedbackIcons = document.querySelectorAll('.feedback-icon');
            feedbackIcons.forEach(icon => {
                icon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                icon.style.display = 'none'; // Hide feedback icon
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>