<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Phrasal Verbs - Dạng D</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f0f2f5;
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Headings */
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9;
            border-left: 6px solid #4CAF50;
            padding: 20px 25px;
            border-radius: 10px;
            color: #388e3c;
        }

        /* Styling for each exercise question */
        .question-item {
            margin-bottom: 30px; /* Increased margin for better separation */
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .question-item .question-text {
            font-size: 1.1em;
            color: #34495e;
            flex-grow: 1; /* Allow text to take available space */
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        .question-item .options-group {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            margin-left: 15px; /* Space between question and options */
            background-color: #eaf6ff;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px dashed #007bff;
        }
        .question-item .options-group .form-check-inline {
            margin-right: 15px;
            margin-bottom: 0;
        }
        .question-item .options-group .form-check-input {
            margin-top: 0.3em;
            width: 1.2em;
            height: 1.2em;
            border-color: #007bff;
        }
        .question-item .options-group .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
        .question-item .options-group .form-check-label {
            font-weight: 600;
            color: #007bff;
            cursor: pointer;
            padding-left: 5px; /* Space between radio and text */
        }

        /* Feedback icons */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            vertical-align: middle;
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        /* Score display color coding */
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .question-text-solution {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .question-item {
                padding: 15px;
                margin-bottom: 20px;
                flex-direction: column; /* Stack items vertically */
                align-items: flex-start; /* Align text to left */
            }
            .question-item .question-text {
                font-size: 1em;
                margin-bottom: 10px;
                width: 100%; /* Full width for text */
            }
            .question-item .options-group {
                margin-left: 0; /* Remove auto margin */
                width: 100%; /* Full width */
                margin-top: 10px; /* Space between text and options */
                justify-content: center; /* Center options */
            }
            .question-item .options-group .form-check-inline {
                margin-right: 10px;
            }
            .buttons .btn {
                font-size: 1.1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.3em;
                padding: 12px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Phrasal Verbs</h1>
        </div>
        <h2>Khoanh tròn từ đúng.</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Circle the correct word.
            <br>
            <strong>Hướng dẫn:</strong> Chọn từ đúng để hoàn thành câu.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <form id="phrasalVerbsForm">
            <div class="mb-4">
                <div class="question-item">
                    <p class="question-text">1. I thought I could trust you! You've really let</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q1" id="q1_off" value="off">
                            <label class="form-check-label" for="q1_off">off</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q1" id="q1_down" value="down">
                            <label class="form-check-label" for="q1_down">down</label>
                        </div>
                    </div>
                    <i class="feedback-icon fa-solid" id="icon1"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">2. Do you get</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q2" id="q2_on" value="on">
                            <label class="form-check-label" for="q2_on">on</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q2" id="q2_in" value="in">
                            <label class="form-check-label" for="q2_in">in</label>
                        </div>
                    </div>
                    <p class="question-text">well with your older sister?</p>
                    <i class="feedback-icon fa-solid" id="icon2"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">3. As children grow</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q3" id="q3_off" value="off">
                            <label class="form-check-label" for="q3_off">off</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q3" id="q3_up" value="up">
                            <label class="form-check-label" for="q3_up">up</label>
                        </div>
                    </div>
                    <p class="question-text">, they want more independence from their parents.</p>
                    <i class="feedback-icon fa-solid" id="icon3"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">4. Dave has fallen</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q4" id="q4_off" value="off">
                            <label class="form-check-label" for="q4_off">off</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q4" id="q4_out" value="out">
                            <label class="form-check-label" for="q4_out">out</label>
                        </div>
                    </div>
                    <p class="question-text">Jason and they're not talking to each other at the moment.</p>
                    <i class="feedback-icon fa-solid" id="icon4"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">5. Ed was brought</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q5" id="q5_in" value="in">
                            <label class="form-check-label" for="q5_in">in</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q5" id="q5_up" value="up">
                            <label class="form-check-label" for="q5_up">up</label>
                        </div>
                    </div>
                    <p class="question-text">by his aunt because his parents lived abroad.</p>
                    <i class="feedback-icon fa-solid" id="icon5"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">6. I used to go</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q6" id="q6_out" value="out">
                            <label class="form-check-label" for="q6_out">out</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q6" id="q6_by" value="by">
                            <label class="form-check-label" for="q6_by">by</label>
                        </div>
                    </div>
                    <p class="question-text">with Tony but we split</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q6_split" id="q6_split_off" value="off">
                            <label class="form-check-label" for="q6_split_off">off</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q6_split" id="q6_split_up" value="up">
                            <label class="form-check-label" for="q6_split_up">up</label>
                        </div>
                    </div>
                    <p class="question-text">about a year ago.</p>
                    <i class="feedback-icon fa-solid" id="icon6"></i>
                </div>

                <div class="question-item">
                    <p class="question-text">7. I hate looking</p>
                    <div class="options-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q7" id="q7_after" value="after">
                            <label class="form-check-label" for="q7_after">after</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="q7" id="q7_over" value="over">
                            <label class="form-check-label" for="q7_over">over</label>
                        </div>
                    </div>
                    <p class="question-text">my baby brother!</p>
                    <i class="feedback-icon fa-solid" id="icon7"></i>
                </div>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra ✨</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại 🔄</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, full sentences, explanations, and translations for each question.
        // For question 6, it has two parts, so its correct_answer will be an array.
        const questionsData = {
            'q1': {
                text_parts: ["I thought I could trust you! You've really let ", "."],
                options: ['off', 'down'],
                correct_answer: 'down',
                fullSentence: "I thought I could trust you! You've really let me down.",
                translation: 'Tôi đã nghĩ rằng tôi có thể tin tưởng bạn! Bạn thực sự đã làm tôi thất vọng.',
                explanation: 'Cụm động từ "let someone down" có nghĩa là làm ai đó thất vọng. Ngữ cảnh câu cho thấy sự thất vọng vì sự thiếu tin cậy.',
                grammar_note: '"Let down" là một phrasal verb tách rời, tân ngữ ("me") nằm giữa "let" và "down".'
            },
            'q2': {
                text_parts: ["Do you get ", " well with your older sister?"],
                options: ['on', 'in'],
                correct_answer: 'on',
                fullSentence: "Do you get on well with your older sister?",
                translation: 'Bạn có hòa thuận với chị gái của bạn không?',
                explanation: 'Cụm động từ "get on well with someone" có nghĩa là có mối quan hệ tốt, hòa thuận với ai đó. "Get in" không phù hợp trong ngữ cảnh này.',
                grammar_note: '"Get on with" là một phrasal verb không tách rời.'
            },
            'q3': {
                text_parts: ["As children grow ", ", they want more independence from their parents."],
                options: ['off', 'up'],
                correct_answer: 'up',
                fullSentence: "As children grow up, they want more independence from their parents.",
                translation: 'Khi trẻ em lớn lên, chúng muốn tự lập hơn từ cha mẹ.',
                explanation: 'Cụm động từ "grow up" có nghĩa là lớn lên, trưởng thành. "Grow off" không có nghĩa này.',
                grammar_note: '"Grow up" là một phrasal verb không tách rời.'
            },
            'q4': {
                text_parts: ["Dave has fallen ", " Jason and they're not talking to each other at the moment."],
                options: ['off', 'out'],
                correct_answer: 'out',
                fullSentence: "Dave has fallen out with Jason and they're not talking to each other at the moment.",
                translation: 'Dave đã cãi nhau với Jason và họ đang không nói chuyện với nhau lúc này.',
                explanation: 'Cụm động từ "fall out with someone" có nghĩa là cãi nhau với ai đó, dẫn đến việc không nói chuyện. "Fall off" không phù hợp.',
                grammar_note: '"Fall out with" là một phrasal verb không tách rời.'
            },
            'q5': {
                text_parts: ["Ed was brought ", " by his aunt because his parents lived abroad."],
                options: ['in', 'up'],
                correct_answer: 'up',
                fullSentence: "Ed was brought up by his aunt because his parents lived abroad.",
                translation: 'Ed được dì của mình nuôi dưỡng vì bố mẹ anh ấy sống ở nước ngoài.',
                explanation: 'Cụm động từ "bring up" (dạng bị động là "be brought up") có nghĩa là nuôi dưỡng, chăm sóc. Ngữ cảnh cho thấy dì là người nuôi dưỡng Ed.',
                grammar_note: '"Bring up" là một phrasal verb tách rời (trong câu bị động thì không rõ ràng).'
            },
            'q6': {
                text_parts: [
                    ["I used to go ", " with Tony"],
                    ["but we split ", " about a year ago."]
                ],
                options: [['out', 'by'], ['off', 'up']],
                correct_answer: ['out', 'up'],
                fullSentence: "I used to go out with Tony but we split up about a year ago.",
                translation: 'Tôi từng hẹn hò với Tony nhưng chúng tôi đã chia tay khoảng một năm trước.',
                explanation: 'Cụm động từ "go out with someone" có nghĩa là hẹn hò với ai đó. "Split up" có nghĩa là chia tay mối quan hệ. Cả hai đều phù hợp với ngữ cảnh của một mối quan hệ đã kết thúc.',
                grammar_note: '"Go out with" và "split up" đều là phrasal verbs không tách rời trong ngữ cảnh này.'
            },
            'q7': {
                text_parts: ["I hate looking ", " my baby brother!"],
                options: ['after', 'over'],
                correct_answer: 'after',
                fullSentence: "I hate looking after my baby brother!",
                translation: 'Tôi ghét phải chăm sóc em trai bé bỏng của mình!',
                explanation: 'Cụm động từ "look after" có nghĩa là chăm sóc ai đó. "Look over" có nghĩa là kiểm tra, xem xét, không phù hợp với ngữ cảnh chăm sóc em bé.',
                grammar_note: '"Look after" là một phrasal verb không tách rời.'
            }
        };

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question
            Object.keys(questionsData).forEach(qId => {
                const questionInfo = questionsData[qId];
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`);
                let isCorrectQuestion = true; // Assume correct until proven otherwise

                // Handle single-part questions (most common)
                if (!Array.isArray(questionInfo.correct_answer)) {
                    const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                    let userAnswer = selectedOption ? selectedOption.value : '';

                    if (userAnswer === questionInfo.correct_answer) {
                        // Mark the selected radio button as correct (if needed, though not visually distinct in this design)
                    } else {
                        isCorrectQuestion = false;
                    }
                } else { // Handle multi-part questions (like q6)
                    questionInfo.correct_answer.forEach((correctPart, index) => {
                        const radioGroupName = index === 0 ? qId : `${qId}_split`; // For q6, first part is 'q6', second is 'q6_split'
                        const selectedOption = document.querySelector(`input[name="${radioGroupName}"]:checked`);
                        let userAnswer = selectedOption ? selectedOption.value : '';

                        if (userAnswer !== correctPart) {
                            isCorrectQuestion = false;
                        }
                    });
                }

                if (isCorrectQuestion) {
                    score++;
                }

                // Show feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrectQuestion) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                // Add detailed solution
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1);
                const questionTextSolutionDiv = document.createElement('div');
                questionTextSolutionDiv.classList.add('question-text-solution');

                let fullTextHtml = `${questionNumber}. `;
                if (!Array.isArray(questionInfo.text_parts[0])) { // Single-part question
                    fullTextHtml += `${questionInfo.text_parts[0]} <span class="correct-answer-text">${questionInfo.correct_answer}</span> ${questionInfo.text_parts[1] || ''}`;
                } else { // Multi-part question (like q6)
                    fullTextHtml += `${questionInfo.text_parts[0][0]} <span class="correct-answer-text">${questionInfo.correct_answer[0]}</span> ${questionInfo.text_parts[0][1] || ''}`;
                    fullTextHtml += ` ${questionInfo.text_parts[1][0]} <span class="correct-answer-text">${questionInfo.correct_answer[1]}</span> ${questionInfo.text_parts[1][1] || ''}`;
                }
                
                questionTextSolutionDiv.innerHTML = fullTextHtml;
                solutionItem.appendChild(questionTextSolutionDiv);

                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${questionInfo.explanation}<br><em>${questionInfo.grammar_note}</em>`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch:</strong> ${questionInfo.translation}`;
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing selected radio buttons, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const radioInputs = document.querySelectorAll('input[type="radio"]');
            radioInputs.forEach(input => {
                input.checked = false; // Uncheck all radio buttons
            });

            const feedbackIcons = document.querySelectorAll('.feedback-icon');
            feedbackIcons.forEach(icon => {
                icon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                icon.style.display = 'none'; // Hide feedback icon
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>