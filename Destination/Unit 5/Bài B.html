<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Ngữ Pháp - Chọn Câu Có Cùng Nghĩa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f0f2f5;
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Headings */
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9;
            border-left: 6px solid #4CAF50;
            padding: 20px 25px;
            border-radius: 10px;
            color: #388e3c;
        }

        /* Styling for each exercise question */
        .question-item {
            margin-bottom: 30px; /* Increased margin for better separation */
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .question-item .original-sentence {
            font-size: 1.1em;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 15px;
        }
        .question-item .form-check {
            margin-bottom: 10px;
            padding-left: 2.5em; /* Space for custom radio button */
        }
        .question-item .form-check-input {
            margin-top: 0.3em;
            margin-left: -1.5em;
        }
        .question-item .form-check-label {
            font-size: 1em;
            color: #555;
            cursor: pointer;
        }
        .question-item .form-check-label:hover {
            color: #007bff;
        }

        /* Feedback icons */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            vertical-align: middle;
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .original-sentence-solution {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .question-item {
                padding: 15px;
                margin-bottom: 20px;
            }
            .question-item .original-sentence {
                font-size: 1em;
                margin-bottom: 10px;
            }
            .question-item .form-check-label {
                font-size: 0.95em;
            }
            .buttons .btn {
                font-size: 1.1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.3em;
                padding: 12px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Ngữ Pháp</h1>
        </div>
        <h2>Chọn câu có cùng nghĩa</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Choose the sentence (A or B) which means the same as the first sentence.
            <br>
            <strong>Hướng dẫn:</strong> Chọn câu (A hoặc B) có nghĩa tương tự với câu đầu tiên.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <form id="multipleChoiceForm">
            <div class="question-item">
                <p class="original-sentence">1. We'd had dinner when Wendy arrived.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1_a" value="A">
                    <label class="form-check-label" for="q1_a">A Wendy arrived and then we had dinner.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1_b" value="B">
                    <label class="form-check-label" for="q1_b">B We had dinner and then Wendy arrived.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon1"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">2. I read the book after I'd seen the film.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2_a" value="A">
                    <label class="form-check-label" for="q2_a">A I saw the film and then I read the book.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2_b" value="B">
                    <label class="form-check-label" for="q2_b">B I read the book and then I saw the film.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon2"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">3. By the time Dad came home, I'd gone to bed.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3_a" value="A">
                    <label class="form-check-label" for="q3_a">A I went to bed before Dad came home.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3_b" value="B">
                    <label class="form-check-label" for="q3_b">B I went to bed after Dad came home.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon3"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">4. She didn't go to bed until her mum had come home.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4_a" value="A">
                    <label class="form-check-label" for="q4_a">A She went to bed and then her mum came home.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4_b" value="B">
                    <label class="form-check-label" for="q4_b">B Her mum came home and then she went to bed.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon4"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">5. Mr Banks hadn't arrived at the office by the time I got there.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5_a" value="A">
                    <label class="form-check-label" for="q5_a">A I arrived before Mr Banks.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5_b" value="B">
                    <label class="form-check-label" for="q5_b">B Mr Banks arrived before me.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon5"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">6. They'd bought the plane tickets before they heard about the cheaper flight.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6_a" value="A">
                    <label class="form-check-label" for="q6_a">A They bought the plane tickets and later they heard about the cheaper flight.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6_b" value="B">
                    <label class="form-check-label" for="q6_b">B They heard about the cheaper flight and then they bought the plane tickets.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon6"></i>
            </div>

            <div class="question-item">
                <p class="original-sentence">7. The girls had tidied the house when the visitors arrived.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7_a" value="A">
                    <label class="form-check-label" for="q7_a">A The visitors arrived and later the girls tidied the house.</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7_b" value="B">
                    <label class="form-check-label" for="q7_b">B The girls tidied the house and then the visitors arrived.</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon7"></i>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, original sentence, options, explanations, and translations
        const questionsData = {
            'q1': {
                originalSentence: 'We\'d had dinner when Wendy arrived.',
                options: {
                    'A': 'Wendy arrived and then we had dinner.',
                    'B': 'We had dinner and then Wendy arrived.'
                },
                correct: 'B',
                translation: 'Chúng tôi đã ăn tối xong khi Wendy đến.',
                explanation: 'Thì Quá khứ Hoàn thành ("We\'d had dinner") diễn tả hành động xảy ra trước một hành động khác trong quá khứ (Wendy arrived). Do đó, chúng tôi đã ăn tối xong rồi Wendy mới đến.',
                grammar_note: 'Quá khứ Hoàn thành (had + P.P.) diễn tả hành động xảy ra trước Quá khứ Đơn (V2/ed).'
            },
            'q2': {
                originalSentence: 'I read the book after I\'d seen the film.',
                options: {
                    'A': 'I saw the film and then I read the book.',
                    'B': 'I read the book and then I saw the film.'
                },
                correct: 'A',
                translation: 'Tôi đọc cuốn sách sau khi tôi đã xem bộ phim.',
                explanation: '"After I\'d seen the film" (sau khi tôi đã xem phim) cho thấy hành động xem phim xảy ra trước hành động đọc sách. "I\'d seen" là viết tắt của "I had seen", sử dụng thì Quá khứ Hoàn thành.',
                grammar_note: '"After" + Quá khứ Hoàn thành, Quá khứ Đơn. Hành động trong Quá khứ Hoàn thành xảy ra trước.'
            },
            'q3': {
                originalSentence: 'By the time Dad came home, I\'d gone to bed.',
                options: {
                    'A': 'I went to bed before Dad came home.',
                    'B': 'I went to bed after Dad came home.'
                },
                correct: 'A',
                translation: 'Vào lúc bố về nhà, tôi đã đi ngủ rồi.',
                explanation: '"By the time Dad came home" (vào lúc bố về nhà) và "I\'d gone to bed" (tôi đã đi ngủ) cho thấy hành động "đi ngủ" xảy ra trước khi "bố về nhà".',
                grammar_note: '"By the time" + Quá khứ Đơn, Quá khứ Hoàn thành. Hành động trong Quá khứ Hoàn thành xảy ra trước.'
            },
            'q4': {
                originalSentence: 'She didn\'t go to bed until her mum had come home.',
                options: {
                    'A': 'She went to bed and then her mum came home.',
                    'B': 'Her mum came home and then she went to bed.'
                },
                correct: 'B',
                translation: 'Cô ấy không đi ngủ cho đến khi mẹ cô ấy về nhà.',
                explanation: '"Until her mum had come home" (cho đến khi mẹ cô ấy về nhà) có nghĩa là cô ấy chỉ đi ngủ sau khi mẹ cô ấy đã về nhà. Hành động "mẹ về nhà" xảy ra trước.',
                grammar_note: '"Not until" + Quá khứ Hoàn thành, Quá khứ Đơn. Hành động trong Quá khứ Hoàn thành xảy ra trước.'
            },
            'q5': {
                originalSentence: 'Mr Banks hadn\'t arrived at the office by the time I got there.',
                options: {
                    'A': 'I arrived before Mr Banks.',
                    'B': 'Mr Banks arrived before me.'
                },
                correct: 'A',
                translation: 'Ông Banks vẫn chưa đến văn phòng vào lúc tôi đến đó.',
                explanation: '"Mr Banks hadn\'t arrived" (ông Banks chưa đến) và "by the time I got there" (vào lúc tôi đến đó) có nghĩa là khi tôi đến, ông Banks vẫn chưa đến. Vậy tôi đến trước ông Banks.',
                grammar_note: 'Quá khứ Hoàn thành (phủ định) + "by the time" + Quá khứ Đơn. Hành động trong Quá khứ Hoàn thành (chưa xảy ra) là hành động xảy ra sau.'
            },
            'q6': {
                originalSentence: 'They\'d bought the plane tickets before they heard about the cheaper flight.',
                options: {
                    'A': 'They bought the plane tickets and later they heard about the cheaper flight.',
                    'B': 'They heard about the cheaper flight and then they bought the plane tickets.'
                },
                correct: 'A',
                translation: 'Họ đã mua vé máy bay trước khi họ nghe về chuyến bay rẻ hơn.',
                explanation: '"They\'d bought the plane tickets before they heard..." (Họ đã mua vé máy bay trước khi họ nghe...) rõ ràng chỉ ra rằng hành động "mua vé" xảy ra trước hành động "nghe về chuyến bay rẻ hơn".',
                grammar_note: 'Quá khứ Hoàn thành + "before" + Quá khứ Đơn. Hành động trong Quá khứ Hoàn thành xảy ra trước.'
            },
            'q7': {
                originalSentence: 'The girls had tidied the house when the visitors arrived.',
                options: {
                    'A': 'The visitors arrived and later the girls tidied the house.',
                    'B': 'The girls tidied the house and then the visitors arrived.'
                },
                correct: 'B',
                translation: 'Các cô gái đã dọn dẹp nhà cửa khi khách đến.',
                explanation: '"The girls had tidied the house" (các cô gái đã dọn dẹp nhà cửa) là hành động ở thì Quá khứ Hoàn thành, xảy ra trước hành động ở thì Quá khứ Đơn "when the visitors arrived" (khi khách đến).',
                grammar_note: 'Quá khứ Hoàn thành + "when" + Quá khứ Đơn. Hành động trong Quá khứ Hoàn thành xảy ra trước.'
            }
        };

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question
            Object.keys(questionsData).forEach(qId => {
                const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                const questionInfo = questionsData[qId];
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`); // e.g., icon1 for q1

                // Reset feedback for all options of the current question
                document.querySelectorAll(`input[name="${qId}"]`).forEach(input => {
                    const label = input.nextElementSibling;
                    label.style.color = '#555'; // Reset label color
                    label.style.fontWeight = 'normal'; // Reset font weight
                });
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    feedbackIcon.style.display = 'none';
                }

                let isCorrect = false;
                if (selectedOption) {
                    if (selectedOption.value === questionInfo.correct) {
                        isCorrect = true;
                        score++;
                        selectedOption.nextElementSibling.style.color = '#198754'; // Green for correct label
                    } else {
                        selectedOption.nextElementSibling.style.color = '#dc3545'; // Red for incorrect label
                    }
                }

                // Show feedback icon
                if (feedbackIcon) {
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                // Highlight correct answer in options
                const correctOptionInput = document.getElementById(`${qId}_${questionInfo.correct.toLowerCase()}`);
                if (correctOptionInput) {
                    correctOptionInput.nextElementSibling.style.fontWeight = 'bold';
                    correctOptionInput.nextElementSibling.style.color = '#007bff'; // Blue for correct answer in options
                }

                // Add detailed solution
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1);
                const questionTextSolutionDiv = document.createElement('div');
                questionTextSolutionDiv.classList.add('original-sentence-solution');
                questionTextSolutionDiv.innerHTML = `${questionNumber}. ${questionInfo.originalSentence}<br>Đáp án đúng: <span class="correct-answer-text">${questionInfo.options[questionInfo.correct]}</span>`;
                solutionItem.appendChild(questionTextSolutionDiv);

                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${questionInfo.explanation}<br>${questionInfo.grammar_note}`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch câu gốc:</strong> ${questionInfo.translation || 'Không có bản dịch.'}`; // Fallback if no translation
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing selections, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.checked = false; // Uncheck all radio buttons
                const label = radio.nextElementSibling;
                label.style.color = '#555'; // Reset label color
                label.style.fontWeight = 'normal'; // Reset font weight
            });

            const feedbackIcons = document.querySelectorAll('.feedback-icon');
            feedbackIcons.forEach(icon => {
                icon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                icon.style.display = 'none'; // Hide feedback icon
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>
