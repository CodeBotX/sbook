<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Ngữ Pháp: Passive Voice - Phần D</title>
    <!-- Bootstrap CSS for styling and responsiveness -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts for "Open Sans" -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for feedback icons (check/cross) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom stylesheet for additional styling -->
    <link rel="stylesheet" href="../../assets/style.css">
    <style>
        /* Adjust input width for longer answers if needed */
        .exercise-item .answer-input.long-answer {
            min-width: 250px; /* Adjust as necessary */
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <!-- Main heading of the exercise -->
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Ngữ Pháp</h1>
        </div>
        <!-- Sub-heading for this specific exercise part -->
        <h2>D. Answer the questions using your own ideas.</h2>
        <!-- Instructions for the user -->
        <p class="instruction">
            <strong>Hướng dẫn:</strong> Trả lời các câu hỏi bằng ý tưởng của riêng bạn.
            <br>
            <span class="text-muted">(Lưu ý: Vì đây là câu trả lời tự do, hệ thống sẽ chỉ hiển thị gợi ý đáp án và giải thích. Đáp án của bạn có thể khác nhưng vẫn đúng.)</span>
        </p>

        <!-- Form containing all the exercise questions -->
        <form id="grammarForm">
            <!-- Question 1 -->
            <div class="exercise-item">
                <span class="question-number">1.</span>
                <span class="text-segment">Where are cars usually fixed? They </span>
                <input type="text" class="form-control answer-input long-answer" id="q1" name="q1">
                <i class="feedback-icon fa-solid" id="icon1"></i>
            </div>

            <!-- Question 2 -->
            <div class="exercise-item">
                <span class="question-number">2.</span>
                <span class="text-segment">Where will the next Olympic Games be held? They </span>
                <input type="text" class="form-control answer-input long-answer" id="q2" name="q2">
                <i class="feedback-icon fa-solid" id="icon2"></i>
            </div>

            <!-- Question 3 -->
            <div class="exercise-item">
                <span class="question-number">3.</span>
                <span class="text-segment">Who are Oscars usually awarded to? They </span>
                <input type="text" class="form-control answer-input long-answer" id="q3" name="q3">
                <i class="feedback-icon fa-solid" id="icon3"></i>
            </div>

            <!-- Question 4 -->
            <div class="exercise-item">
                <span class="question-number">4.</span>
                <span class="text-segment">What are you not allowed to do at school? I </span>
                <input type="text" class="form-control answer-input long-answer" id="q4" name="q4">
                <i class="feedback-icon fa-solid" id="icon4"></i>
            </div>

            <!-- Question 5 -->
            <div class="exercise-item">
                <span class="question-number">5.</span>
                <span class="text-segment">What were you given for your birthday last year? I </span>
                <input type="text" class="form-control answer-input long-answer" id="q5" name="q5">
                <i class="feedback-icon fa-solid" id="icon5"></i>
            </div>

            <!-- Question 6 -->
            <div class="exercise-item">
                <span class="question-number">6.</span>
                <span class="text-segment">What will you be given for your next birthday? I'll probably </span>
                <input type="text" class="form-control answer-input long-answer" id="q6" name="q6">
                <i class="feedback-icon fa-solid" id="icon6"></i>
            </div>

            <!-- Action buttons -->
            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <!-- Score display area -->
        <div id="scoreDisplay" class="score-display mt-4"></div>

        <!-- Detailed solution section, hidden by default -->
        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                <!-- Solutions will be dynamically added here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Link to common JavaScript functions -->
    <script src="../../assets/common.js"></script>

    <script>
        // Data containing correct answers (example answers), original text, fixed text templates, explanations, and grammar notes for each question.
        const questionsData = {
            'q1': {
                correctAnswers: ['are usually fixed in a garage', 'are fixed in a garage'],
                originalText: 'Where are cars usually fixed? They __________',
                fixedTextTemplate: 'Where are cars usually fixed? They <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Ô tô thường được sửa chữa tại gara. Đây là thì hiện tại đơn bị động, diễn tả một hành động thường xuyên hoặc một sự thật chung.',
                grammarNote: 'Cấu trúc: S + am/is/are + (adv) + P.P.'
            },
            'q2': {
                correctAnswers: ['will be held in Paris', 'will be held in Los Angeles', 'will be held in Brisbane'], // Example answers, user can have their own
                originalText: 'Where will the next Olympic Games be held? They __________',
                fixedTextTemplate: 'Where will the next Olympic Games be held? They <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Thế vận hội Olympic tiếp theo sẽ được tổ chức tại Paris. Đây là thì tương lai đơn bị động, diễn tả một sự kiện sẽ diễn ra trong tương lai.',
                grammarNote: 'Cấu trúc: S + will + be + P.P.'
            },
            'q3': {
                correctAnswers: ['are usually awarded to actors and filmmakers', 'are awarded to actors and filmmakers'],
                originalText: 'Who are Oscars usually awarded to? They __________',
                fixedTextTemplate: 'Who are Oscars usually awarded to? They <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Giải Oscar thường được trao cho các diễn viên và nhà làm phim. Đây là thì hiện tại đơn bị động, diễn tả một hành động thường xuyên hoặc một sự thật chung.',
                grammarNote: 'Cấu trúc: S + am/is/are + (adv) + P.P.'
            },
            'q4': {
                correctAnswers: ['am not allowed to use my phone in class', 'am not allowed to chew gum', 'am not allowed to run in the hallways'], // Example answers
                originalText: 'What are you not allowed to do at school? I __________',
                fixedTextTemplate: 'What are you not allowed to do at school? I <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Tôi không được phép sử dụng điện thoại trong lớp. Đây là thì hiện tại đơn bị động, diễn tả một quy định hoặc điều không được phép làm.',
                grammarNote: 'Cấu trúc: S + am/is/are + not + P.P.'
            },
            'q5': {
                correctAnswers: ['was given a new book', 'was given some clothes', 'was given a new phone'], // Example answers
                originalText: 'What were you given for your birthday last year? I __________',
                fixedTextTemplate: 'What were you given for your birthday last year? I <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Tôi được tặng một cuốn sách mới. Đây là thì quá khứ đơn bị động, diễn tả một hành động đã xảy ra và hoàn thành trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q6': {
                correctAnswers: ['be given some money', 'be given a new laptop', 'be given a surprise party'], // Example answers
                originalText: 'What will you be given for your next birthday? I\'ll probably __________',
                fixedTextTemplate: 'What will you be given for your next birthday? I\'ll probably <span class="correct-answer-text">{answer}</span>.',
                explanation: 'Câu trả lời mẫu: Tôi có thể sẽ được tặng một ít tiền. Đây là thì tương lai đơn bị động, diễn tả một hành động có thể xảy ra trong tương lai.',
                grammarNote: 'Cấu trúc: S + will + be + P.P.'
            }
        };

        /**
         * Submits the user's answers for the Passive Voice exercise,
         * calculates the score, provides feedback, and displays detailed solutions.
         * This function uses generic helpers from common.js.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            // Clear previous solutions and show solution section
            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = '';
            document.getElementById('detailedSolution').style.display = 'block';

            // Loop through all questions
            for (let i = 1; i <= totalQuestions; i++) {
                const qId = `q${i}`;
                const inputElement = document.getElementById(qId);
                const feedbackIcon = document.getElementById(`icon${i}`);
                const questionData = questionsData[qId];

                if (!inputElement || !questionData) {
                    console.warn(`Missing element or data for ${qId}`);
                    continue;
                }

                const userAnswer = normalizeAnswer(inputElement.value); // Use normalizeAnswer from common.js
                let isCorrect = false;

                // For "your own ideas" exercises, we just show the example answer and explanation.
                // The 'isCorrect' logic here will only check against the provided example answers.
                // It's important to communicate to the user that their answer might be correct even if not matching exactly.
                isCorrect = questionData.correctAnswers.some(correctAns => normalizeAnswer(correctAns) === userAnswer);

                // Display feedback on the input field
                inputElement.classList.remove('is-valid', 'is-invalid');
                if (isCorrect) {
                    inputElement.classList.add('is-valid');
                } else {
                    // For "own ideas" questions, we might not mark it "invalid" directly,
                    // but rather just show the solution. However, to keep consistency with
                    // the existing feedback mechanism, we'll mark it invalid if it doesn't match the examples.
                    inputElement.classList.add('is-invalid');
                }

                // Display feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                if (isCorrect) {
                    score++;
                }

                // Add detailed solution using the common function
                addSolutionItem(i, questionData, userAnswer); // Use addSolutionItem from common.js
            }

            // Display the final score using the common function
            displayScore(score, totalQuestions); // Use displayScore from common.js
        }

        // The resetExercise function is imported from common.js and works universally
    </script>
</body>
</html>
