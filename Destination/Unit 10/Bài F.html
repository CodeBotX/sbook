<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Ngữ Pháp: Passive Voice - Phần F</title>
    <!-- Bootstrap CSS for styling and responsiveness -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts for "Open Sans" -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for feedback icons (check/cross) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom stylesheet for additional styling -->
    <link rel="stylesheet" href="../../assets/style.css">
    <style>
        /* Adjust input width for single word answers */
        .exercise-item .answer-input.single-word {
            min-width: 60px;
            max-width: 100px;
            text-align: center; /* Center text for single word inputs */
        }
        .passage-text {
            font-size: 1.1em;
            line-height: 1.8;
            text-align: justify;
            margin-bottom: 20px;
        }
        .passage-text .exercise-item {
            display: inline-flex; /* Use inline-flex to align number, input, and icon */
            align-items: baseline; /* Align text baselines */
            margin-bottom: 0;
            vertical-align: middle; /* Align the whole inline-flex item vertically */
        }
        .passage-text .question-number {
            display: inline-block; /* Keep number with input */
            margin-right: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .passage-text .feedback-icon {
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <!-- Main heading of the exercise -->
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Ngữ Pháp</h1>
        </div>
        <!-- Sub-heading for this specific exercise part -->
        <h2>F. Write one word in each gap.</h2>
        <!-- Instructions for the user -->
        <p class="instruction">
            <strong>Hướng dẫn:</strong> Viết một từ vào mỗi chỗ trống.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <!-- Form containing the passage with gaps -->
        <form id="grammarForm">
            <div class="passage-text">
                There are lots of beautiful, large houses in Britain. Many of them
                <div class="exercise-item">
                    <span class="question-number">1.</span>
                    <input type="text" class="form-control answer-input single-word" id="q1" name="q1">
                    <i class="feedback-icon fa-solid" id="icon1"></i>
                </div>
                built hundreds of years ago. In the past, they
                <div class="exercise-item">
                    <span class="question-number">2.</span>
                    <input type="text" class="form-control answer-input single-word" id="q2" name="q2">
                    <i class="feedback-icon fa-solid" id="icon2"></i>
                </div>
                owned by very rich families. Today, many of them
                <div class="exercise-item">
                    <span class="question-number">3.</span>
                    <input type="text" class="form-control answer-input single-word" id="q3" name="q3">
                    <i class="feedback-icon fa-solid" id="icon3"></i>
                </div>
                owned by an organisation called The National Trust, which
                <div class="exercise-item">
                    <span class="question-number">4.</span>
                    <input type="text" class="form-control answer-input single-word" id="q4" name="q4">
                    <i class="feedback-icon fa-solid" id="icon4"></i>
                </div>
                created to look after them. The houses
                <div class="exercise-item">
                    <span class="question-number">5.</span>
                    <input type="text" class="form-control answer-input single-word" id="q5" name="q5">
                    <i class="feedback-icon fa-solid" id="icon5"></i>
                </div>
                kept in perfect condition, and visitors
                <div class="exercise-item">
                    <span class="question-number">6.</span>
                    <input type="text" class="form-control answer-input single-word" id="q6" name="q6">
                    <i class="feedback-icon fa-solid" id="icon6"></i>
                </div>
                allowed to look round them. It's interesting to learn how different life was in an old house. Milk was
                <div class="exercise-item">
                    <span class="question-number">7.</span>
                    <input type="text" class="form-control answer-input single-word" id="q7" name="q7">
                    <i class="feedback-icon fa-solid" id="icon7"></i>
                </div>
                kept in the fridge, because they didn't have fridges! Washing machines
                <div class="exercise-item">
                    <span class="question-number">8.</span>
                    <input type="text" class="form-control answer-input single-word" id="q8" name="q8">
                    <i class="feedback-icon fa-solid" id="icon8"></i>
                </div>
                only invented very recently, so washing
                <div class="exercise-item">
                    <span class="question-number">9.</span>
                    <input type="text" class="form-control answer-input single-word" id="q9" name="q9">
                    <i class="feedback-icon fa-solid" id="icon9"></i>
                </div>
                done by hand. In some cases, the house
                <div class="exercise-item">
                    <span class="question-number">10.</span>
                    <input type="text" class="form-control answer-input single-word" id="q10" name="q10">
                    <i class="feedback-icon fa-solid" id="icon10"></i>
                </div>
                still lived in today. When this happens, visitors
                <div class="exercise-item">
                    <span class="question-number">11.</span>
                    <input type="text" class="form-control answer-input single-word" id="q11" name="q11">
                    <i class="feedback-icon fa-solid" id="icon11"></i>
                </div>
                only shown part of the house. The private rooms
                <div class="exercise-item">
                    <span class="question-number">12.</span>
                    <input type="text" class="form-control answer-input single-word" id="q12" name="q12">
                    <i class="feedback-icon fa-solid" id="icon12"></i>
                </div>
                kept closed to the public. These houses often have beautiful gardens, too. The gardens
                <div class="exercise-item">
                    <span class="question-number">13.</span>
                    <input type="text" class="form-control answer-input single-word" id="q13" name="q13">
                    <i class="feedback-icon fa-solid" id="icon13"></i>
                </div>
                looked after by professional gardeners.
                You usually have to pay to look round National Trust houses. Members of the National Trust
                <div class="exercise-item">
                    <span class="question-number">14.</span>
                    <input type="text" class="form-control answer-input single-word" id="q14" name="q14">
                    <i class="feedback-icon fa-solid" id="icon14"></i>
                </div>
                given a discount. This year, millions of people
                <div class="exercise-item">
                    <span class="question-number">15.</span>
                    <input type="text" class="form-control answer-input single-word" id="q15" name="q15">
                    <i class="feedback-icon fa-solid" id="icon15"></i>
                </div>
                be given the chance to see what life in an old country house was like.
            </div>

            <!-- Action buttons -->
            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <!-- Score display area -->
        <div id="scoreDisplay" class="score-display mt-4"></div>

        <!-- Detailed solution section, hidden by default -->
        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                <!-- Solutions will be dynamically added here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Link to common JavaScript functions -->
    <script src="../../assets/common.js"></script>

    <script>
        // Data containing correct answers, original text, fixed text templates, explanations, and grammar notes for each question.
        const questionsData = {
            'q1': {
                correctAnswers: ['were'],
                originalText: 'Many of them built hundreds of years ago.',
                fixedTextTemplate: 'Many of them <span class="correct-answer-text">{answer}</span> built hundreds of years ago.',
                explanation: 'Thì quá khứ đơn bị động. "Many of them" (ám chỉ những ngôi nhà) là số nhiều và hành động "built" (xây dựng) xảy ra trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q2': {
                correctAnswers: ['were'],
                originalText: 'In the past, they owned by very rich families.',
                fixedTextTemplate: 'In the past, they <span class="correct-answer-text">{answer}</span> owned by very rich families.',
                explanation: 'Thì quá khứ đơn bị động. "They" (ám chỉ những ngôi nhà) là số nhiều và hành động "owned" (sở hữu) xảy ra trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q3': {
                correctAnswers: ['are'],
                originalText: 'Today, many of them owned by an organisation called The National Trust,',
                fixedTextTemplate: 'Today, many of them <span class="correct-answer-text">{answer}</span> owned by an organisation called The National Trust,',
                explanation: 'Thì hiện tại đơn bị động. "Many of them" là số nhiều và hành động "owned" (sở hữu) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q4': {
                correctAnswers: ['was'],
                originalText: 'which created to look after them.',
                fixedTextTemplate: 'which <span class="correct-answer-text">{answer}</span> created to look after them.',
                explanation: 'Thì quá khứ đơn bị động. "Which" ở đây thay thế cho "The National Trust" (số ít) và hành động "created" (thành lập) đã xảy ra trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q5': {
                correctAnswers: ['are'],
                originalText: 'The houses kept in perfect condition,',
                fixedTextTemplate: 'The houses <span class="correct-answer-text">{answer}</span> kept in perfect condition,',
                explanation: 'Thì hiện tại đơn bị động. "The houses" là số nhiều và hành động "kept" (giữ gìn) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q6': {
                correctAnswers: ['are'],
                originalText: 'and visitors allowed to look round them.',
                fixedTextTemplate: 'and visitors <span class="correct-answer-text">{answer}</span> allowed to look round them.',
                explanation: 'Thì hiện tại đơn bị động. "Visitors" là số nhiều và hành động "allowed" (cho phép) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q7': {
                correctAnswers: ['was'],
                originalText: 'Milk was kept in the fridge,',
                fixedTextTemplate: 'Milk was <span class="correct-answer-text">{answer}</span> kept in the fridge,',
                explanation: 'Thì quá khứ đơn bị động. "Milk" là danh từ không đếm được (số ít) và hành động "kept" (giữ) xảy ra trong quá khứ. Cần "was" để hoàn thành cấu trúc bị động.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q8': {
                correctAnswers: ['were'],
                originalText: 'Washing machines only invented very recently,',
                fixedTextTemplate: 'Washing machines <span class="correct-answer-text">{answer}</span> only invented very recently,',
                explanation: 'Thì quá khứ đơn bị động. "Washing machines" là số nhiều và hành động "invented" (phát minh) xảy ra trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q9': {
                correctAnswers: ['was'],
                originalText: 'so washing done by hand.',
                fixedTextTemplate: 'so washing <span class="correct-answer-text">{answer}</span> done by hand.',
                explanation: 'Thì quá khứ đơn bị động. "Washing" (việc giặt giũ) là danh từ không đếm được (số ít) và hành động "done" (thực hiện) xảy ra trong quá khứ.',
                grammarNote: 'Cấu trúc: S + was/were + P.P.'
            },
            'q10': {
                correctAnswers: ['is'],
                originalText: 'In some cases, the house still lived in today.',
                fixedTextTemplate: 'In some cases, the house <span class="correct-answer-text">{answer}</span> still lived in today.',
                explanation: 'Thì hiện tại đơn bị động. "The house" là số ít và hành động "lived in" (được sống trong) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q11': {
                correctAnswers: ['are'],
                originalText: 'When this happens, visitors only shown part of the house.',
                fixedTextTemplate: 'When this happens, visitors <span class="correct-answer-text">{answer}</span> only shown part of the house.',
                explanation: 'Thì hiện tại đơn bị động. "Visitors" là số nhiều và hành động "shown" (được cho xem) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q12': {
                correctAnswers: ['are'],
                originalText: 'The private rooms kept closed to the public.',
                fixedTextTemplate: 'The private rooms <span class="correct-answer-text">{answer}</span> kept closed to the public.',
                explanation: 'Thì hiện tại đơn bị động. "The private rooms" là số nhiều và hành động "kept" (được giữ) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q13': {
                correctAnswers: ['are'],
                originalText: 'The gardens looked after by professional gardeners.',
                fixedTextTemplate: 'The gardens <span class="correct-answer-text">{answer}</span> looked after by professional gardeners.',
                explanation: 'Thì hiện tại đơn bị động. "The gardens" là số nhiều và hành động "looked after" (được chăm sóc) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q14': {
                correctAnswers: ['are'],
                originalText: 'Members of the National Trust given a discount.',
                fixedTextTemplate: 'Members of the National Trust <span class="correct-answer-text">{answer}</span> given a discount.',
                explanation: 'Thì hiện tại đơn bị động. "Members" là số nhiều và hành động "given" (được tặng) diễn ra ở hiện tại.',
                grammarNote: 'Cấu trúc: S + am/is/are + P.P.'
            },
            'q15': {
                correctAnswers: ['will'],
                originalText: 'This year, millions of people be given the chance to see what life in an old country house was like.',
                fixedTextTemplate: 'This year, millions of people <span class="correct-answer-text">{answer}</span> be given the chance to see what life in an old country house was like.',
                explanation: 'Thì tương lai đơn bị động. "Millions of people" là số nhiều và hành động "be given" (sẽ được trao) diễn ra trong tương lai. Cần "will" để hoàn thành cấu trúc.',
                grammarNote: 'Cấu trúc: S + will + be + P.P.'
            }
        };

        /**
         * Submits the user's answers for the Passive Voice exercise,
         * calculates the score, provides feedback, and displays detailed solutions.
         * This function uses generic helpers from common.js.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            // Clear previous solutions and show solution section
            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = '';
            document.getElementById('detailedSolution').style.display = 'block';

            // Loop through all questions
            for (let i = 1; i <= totalQuestions; i++) {
                const qId = `q${i}`;
                const inputElement = document.getElementById(qId);
                const feedbackIcon = document.getElementById(`icon${i}`);
                const questionData = questionsData[qId];

                if (!inputElement || !questionData) {
                    console.warn(`Missing element or data for ${qId}`);
                    continue;
                }

                const userAnswer = normalizeAnswer(inputElement.value); // Use normalizeAnswer from common.js
                let isCorrect = false;

                // Check if the user's answer matches any of the correct answers
                isCorrect = questionData.correctAnswers.some(correctAns => normalizeAnswer(correctAns) === userAnswer);

                // Display feedback on the input field
                inputElement.classList.remove('is-valid', 'is-invalid');
                if (isCorrect) {
                    inputElement.classList.add('is-valid');
                } else {
                    inputElement.classList.add('is-invalid');
                }

                // Display feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                if (isCorrect) {
                    score++;
                }

                // Add detailed solution using the common function
                addSolutionItem(i, questionData, userAnswer); // Use addSolutionItem from common.js
            }

            // Display the final score using the common function
            displayScore(score, totalQuestions); // Use displayScore from common.js
        }

        // The resetExercise function is imported from common.js and works universally
    </script>
</body>
</html>
