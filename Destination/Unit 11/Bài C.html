<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Ngữ Pháp: Passive Voice - Phần C (By or With)</title>
    <!-- Bootstrap CSS for styling and responsiveness -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts for "Open Sans" -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for feedback icons (check/cross) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom stylesheet for additional styling -->
    <link rel="stylesheet" href="../../assets/style.css">
    <style>
        /* Styling for select inputs */
        .exercise-item .form-select {
            display: inline-block;
            width: auto; /* Adjust width based on content */
            max-width: 150px; /* Limit max width */
            margin: 0 5px; /* Spacing around the select box */
            vertical-align: middle; /* Align with text */
            border-radius: 8px; /* Rounded corners */
            padding: 5px 10px; /* Padding inside */
            font-size: 1em; /* Readable font size */
            border: 1px solid #ced4da; /* Default border */
        }

        .exercise-item .form-select.is-valid {
            border-color: #198754 !important;
            box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25) !important;
        }

        .exercise-item .form-select.is-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <!-- Main heading of the exercise -->
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Ngữ Pháp</h1>
        </div>
        <!-- Sub-heading for this specific exercise part -->
        <h2>C. Complete using by or with.</h2>
        <!-- Instructions for the user -->
        <p class="instruction">
            <strong>Hướng dẫn:</strong> Hoàn thành câu bằng cách sử dụng "by" hoặc "with".
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <!-- Form containing all the exercise questions -->
        <form id="grammarForm">
            <!-- Question 1 -->
            <div class="exercise-item">
                <span class="question-number">1.</span>
                <span class="text-segment">That book was written </span>
                <select class="form-select answer-input" id="q1" name="q1">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> my uncle!</span>
                <i class="feedback-icon fa-solid" id="icon1"></i>
            </div>

            <!-- Question 2 -->
            <div class="exercise-item">
                <span class="question-number">2.</span>
                <span class="text-segment">Are the best photos usually taken </span>
                <select class="form-select answer-input" id="q2" name="q2">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> digital cameras?</span>
                <i class="feedback-icon fa-solid" id="icon2"></i>
            </div>

            <!-- Question 3 -->
            <div class="exercise-item">
                <span class="question-number">3.</span>
                <span class="text-segment">That song has been sung </span>
                <select class="form-select answer-input" id="q3" name="q3">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> lots of famous singers.</span>
                <i class="feedback-icon fa-solid" id="icon3"></i>
            </div>

            <!-- Question 4 -->
            <div class="exercise-item">
                <span class="question-number">4.</span>
                <span class="text-segment">Is your hair cut </span>
                <select class="form-select answer-input" id="q4" name="q4">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> a professional hairdresser?</span>
                <i class="feedback-icon fa-solid" id="icon4"></i>
            </div>

            <!-- Question 5 -->
            <div class="exercise-item">
                <span class="question-number">5.</span>
                <span class="text-segment">Should the paper be cut </span>
                <select class="form-select answer-input" id="q5" name="q5">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> a pair of scissors?</span>
                <i class="feedback-icon fa-solid" id="icon5"></i>
            </div>

            <!-- Question 6 -->
            <div class="exercise-item">
                <span class="question-number">6.</span>
                <span class="text-segment">All the candles had been lit </span>
                <select class="form-select answer-input" id="q6" name="q6">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> the same match.</span>
                <i class="feedback-icon fa-solid" id="icon6"></i>
            </div>

            <!-- Question 7 -->
            <div class="exercise-item">
                <span class="question-number">7.</span>
                <span class="text-segment">The film isn't going to be directed </span>
                <select class="form-select answer-input" id="q7" name="q7">
                    <option value="">Chọn...</option>
                    <option value="by">by</option>
                    <option value="with">with</option>
                </select>
                <span class="text-segment"> Steven Spielberg after all.</span>
                <i class="feedback-icon fa-solid" id="icon7"></i>
            </div>

            <!-- Action buttons -->
            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Link to common JavaScript functions -->
    <script src="../../assets/common.js"></script>

    <script>
        // Data containing correct answers, original text, fixed text templates, explanations, and grammar notes for each question.
        const questionsData = {
            'q1': {
                correctAnswers: ['by'],
                originalText: 'That book was written __________ my uncle!',
                fixedTextTemplate: 'That book was written <span class="correct-answer-text">{answer}</span> my uncle!',
                explanation: '"By" được dùng để chỉ tác nhân thực hiện hành động (agent). "My uncle" là người viết cuốn sách.',
                grammarNote: 'Sử dụng "by" cho tác nhân (người/vật thực hiện hành động).'
            },
            'q2': {
                correctAnswers: ['with'],
                originalText: 'Are the best photos usually taken __________ digital cameras?',
                fixedTextTemplate: 'Are the best photos usually taken <span class="correct-answer-text">{answer}</span> digital cameras?',
                explanation: '"With" được dùng để chỉ công cụ (instrument) hoặc phương tiện (means) được sử dụng để thực hiện hành động. "Digital cameras" là công cụ.',
                grammarNote: 'Sử dụng "with" cho công cụ hoặc phương tiện.'
            },
            'q3': {
                correctAnswers: ['by'],
                originalText: 'That song has been sung __________ lots of famous singers.',
                fixedTextTemplate: 'That song has been sung <span class="correct-answer-text">{answer}</span> lots of famous singers.',
                explanation: '"By" được dùng để chỉ tác nhân thực hiện hành động. "Lots of famous singers" là những người hát bài hát.',
                grammarNote: 'Sử dụng "by" cho tác nhân (người/vật thực hiện hành động).'
            },
            'q4': {
                correctAnswers: ['by'],
                originalText: 'Is your hair cut __________ a professional hairdresser?',
                fixedTextTemplate: 'Is your hair cut <span class="correct-answer-text">{answer}</span> a professional hairdresser?',
                explanation: '"By" được dùng để chỉ tác nhân thực hiện hành động. "A professional hairdresser" là người cắt tóc.',
                grammarNote: 'Sử dụng "by" cho tác nhân (người/vật thực hiện hành động).'
            },
            'q5': {
                correctAnswers: ['with'],
                originalText: 'Should the paper be cut __________ a pair of scissors?',
                fixedTextTemplate: 'Should the paper be cut <span class="correct-answer-text">{answer}</span> a pair of scissors?',
                explanation: '"With" được dùng để chỉ công cụ. "A pair of scissors" là công cụ được dùng để cắt giấy.',
                grammarNote: 'Sử dụng "with" cho công cụ hoặc phương tiện.'
            },
            'q6': {
                correctAnswers: ['with'],
                originalText: 'All the candles had been lit __________ the same match.',
                fixedTextTemplate: 'All the candles had been lit <span class="correct-answer-text">{answer}</span> the same match.',
                explanation: '"With" được dùng để chỉ công cụ. "The same match" là công cụ được dùng để thắp nến.',
                grammarNote: 'Sử dụng "with" cho công cụ hoặc phương tiện.'
            },
            'q7': {
                correctAnswers: ['by'],
                originalText: 'The film isn\'t going to be directed __________ Steven Spielberg after all.',
                fixedTextTemplate: 'The film isn\'t going to be directed <span class="correct-answer-text">{answer}</span> Steven Spielberg after all.',
                explanation: '"By" được dùng để chỉ tác nhân thực hiện hành động. "Steven Spielberg" là đạo diễn của bộ phim.',
                grammarNote: 'Sử dụng "by" cho tác nhân (người/vật thực hiện hành động).'
            }
        };

        /**
         * Submits the user's answers for the Passive Voice exercise,
         * calculates the score, provides feedback, and displays detailed solutions.
         * This function uses generic helpers from common.js.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            // Clear previous solutions and show solution section
            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = '';
            document.getElementById('detailedSolution').style.display = 'block';

            // Loop through all questions
            for (let i = 1; i <= totalQuestions; i++) {
                const qId = `q${i}`;
                const inputElement = document.getElementById(qId); // This will be a <select> element
                const feedbackIcon = document.getElementById(`icon${i}`);
                const questionData = questionsData[qId];

                if (!inputElement || !questionData) {
                    console.warn(`Missing element or data for ${qId}`);
                    continue;
                }

                const userAnswer = normalizeAnswer(inputElement.value); // Get selected value
                let isCorrect = false;

                // Check if the user's selected answer matches any of the correct answers
                isCorrect = questionData.correctAnswers.some(correctAns => normalizeAnswer(correctAns) === userAnswer);

                // Display feedback on the select element
                inputElement.classList.remove('is-valid', 'is-invalid');
                if (isCorrect) {
                    inputElement.classList.add('is-valid');
                } else {
                    inputElement.classList.add('is-invalid');
                }

                // Display feedback icon
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                if (isCorrect) {
                    score++;
                }

                // Add detailed solution using the common function
                addSolutionItem(i, questionData, userAnswer); // Use addSolutionItem from common.js
            }

            // Display the final score using the common function
            displayScore(score, totalQuestions); // Use displayScore from common.js
        }

        // The resetExercise function is imported from common.js and works universally
        // because it targets elements by class 'answer-input' (which now includes <select>) and 'feedback-icon'.
        // It will also reset the <select> to its first option.
    </script>
</body>
</html>
