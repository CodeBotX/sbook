<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài tập Ngữ pháp - Sửa lỗi thì</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin-top: 50px;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        .exercise-text {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 5px;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        .form-label {
            font-weight: bold;
        }
        .result-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
        .incorrect-answer {
            color: #dc3545;
            font-weight: bold;
        }
        .explanation, .vietnamese-translation {
            font-size: 0.95rem;
            color: #495057;
            margin-top: 5px;
        }
        .edit-area {
            display: none; /* Hidden by default */
            margin-top: 10px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
        }
        .edit-area textarea {
            width: 100%;
            min-height: 80px;
            margin-bottom: 5px;
        }
        .btn-check-answers {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-check-answers:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4 text-center">Bài tập Ngữ pháp: Sửa lỗi thì của động từ</h2>
        <p class="lead text-center">F Underline ten verbs in the wrong tense and rewrite them correctly.</p>

        <div class="exercise-text">
            'One game I <span class="highlight-verb" data-original-verb="am loving">am loving</span> is backgammon. You <span class="highlight-verb" data-original-verb="are throwing">are throwing</span> the dice and then you move your pieces around the board. It <span class="highlight-verb" data-original-verb="is seeming">is seeming</span> quite easy, but in fact you <span class="highlight-verb" data-original-verb="are needing">are needing</span> to be quite careful. When your piece lands on one of the other person's pieces, you <span class="highlight-verb" data-original-verb="are taking">are taking</span> it off the board and you send it back to the beginning. You <span class="highlight-verb" data-original-verb="are winning">are winning</span> by getting all your pieces to the end and off the board. Some people <span class="highlight-verb" data-original-verb="are preferring">are preferring</span> chess, but I <span class="highlight-verb" data-original-verb="am not understanding">am not understanding</span> that game. Right now, I <span class="highlight-verb" data-original-verb="wait">wait</span> to have a game with my brother. He <span class="highlight-verb" data-original-verb="does his homework">does his homework</span>. I usually win, so I think he doesn't want to play a game with me!'
        </div>

        <form id="exerciseForm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="ans1" class="form-label">1.</label>
                    <input type="text" class="form-control" id="ans1" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans2" class="form-label">2.</label>
                    <input type="text" class="form-control" id="ans2" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans3" class="form-label">3.</label>
                    <input type="text" class="form-control" id="ans3" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans4" class="form-label">4.</label>
                    <input type="text" class="form-control" id="ans4" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans5" class="form-label">5.</label>
                    <input type="text" class="form-control" id="ans5" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans6" class="form-label">6.</label>
                    <input type="text" class="form-control" id="ans6" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans7" class="form-label">7.</label>
                    <input type="text" class="form-control" id="ans7" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans8" class="form-label">8.</label>
                    <input type="text" class="form-control" id="ans8" placeholder="Viết lại động từ đúng">
                </div>
                <div class="col-md-6">
                    <label for="ans9" class="form-label">9.</label>
                    <input type="text" class="form-control" id="ans9" placeholder="Viết lại động từ đúng">
                </div>
                 <div class="col-md-6">
                    <label for="ans10" class="form-label">10.</label>
                    <input type="text" class="form-control" id="ans10" placeholder="Viết lại động từ đúng">
                </div>
            </div>
            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-check-answers">Kiểm tra Đáp án</button>
                <button type="button" class="btn btn-secondary" id="resetBtn">Làm lại</button>
            </div>
        </form>

        <div id="results" class="result-section" style="display: none;">
            <h3 class="mb-3 text-center">Kết quả và Lời giải chi tiết</h3>
            <div id="feedback"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const form = document.getElementById('exerciseForm');
        const resultsDiv = document.getElementById('results');
        const feedbackDiv = document.getElementById('feedback');
        const resetBtn = document.getElementById('resetBtn');

        // Initial data for verbs, including the correct answers, explanations, and translations.
        // This array will be used to store and manage the data.
        let verbsData = [
            { id: 'ans1', original: 'am loving', correct: 'love', explanation: "Động từ 'love' là một stative verb (động từ trạng thái), thường không dùng ở thì tiếp diễn. Nó diễn tả cảm xúc cố định, không phải hành động đang diễn ra.", translation: "Yêu thích một trò chơi là một sở thích lâu dài, không phải hành động nhất thời." },
            { id: 'ans2', original: 'are throwing', correct: 'throw', explanation: "Đây là một mô tả chung về cách chơi của trò backgammon, diễn tả một sự thật hoặc hành động thường xuyên, không phải hành động đang diễn ra tại thời điểm nói. Do đó, sử dụng thì Hiện tại đơn (Present Simple) là phù hợp.", translation: "Hành động 'ném xúc xắc' là một phần của quy tắc trò chơi, diễn ra lặp lại." },
            { id: 'ans3', original: 'is seeming', correct: 'seems', explanation: "'Seem' là một stative verb, diễn tả một trạng thái hoặc vẻ bề ngoài, không dùng ở thì tiếp diễn.", translation: "Cảm giác 'có vẻ' dễ dàng là một đánh giá trạng thái." },
            { id: 'ans4', original: 'are needing', correct: 'need', explanation: "'Need' là một stative verb, diễn tả sự cần thiết hoặc yêu cầu, không dùng ở thì tiếp diễn.", translation: "Việc 'cần' cẩn thận là một yêu cầu cố định khi chơi." },
            { id: 'ans5', original: 'are taking', correct: 'take', explanation: "Đây là một mô tả chung về quy tắc của trò chơi (nếu một quân cờ rơi vào quân khác thì bạn làm gì). Sử dụng thì Hiện tại đơn để diễn tả sự thật hoặc hành động thường xuyên xảy ra theo một điều kiện.", translation: "Hành động 'lấy đi' quân cờ là một quy tắc chung của trò chơi." },
            { id: 'ans6', original: 'are winning', correct: 'win', explanation: "Tương tự, đây là mô tả cách thức chiến thắng trong trò chơi, một sự thật hoặc quy tắc chung. Sử dụng thì Hiện tại đơn.", translation: "Việc 'thắng' là kết quả của việc hoàn thành trò chơi, một sự thật." },
            { id: 'ans7', original: 'are preferring', correct: 'prefer', explanation: "'Prefer' là một stative verb, diễn tả sở thích, không dùng ở thì tiếp diễn.", translation: "Việc 'thích' cờ vua là một sở thích lâu dài, không thay đổi." },
            { id: 'ans8', original: 'am not understanding', correct: "don't understand", explanation: "'Understand' là một stative verb, diễn tả trạng thái nhận thức, không dùng ở thì tiếp diễn.", translation: "Việc 'không hiểu' trò chơi là một trạng thái nhận thức cố định." },
            { id: 'ans9', original: 'wait', correct: 'am waiting', explanation: "Cụm từ 'Right now' chỉ ra rằng hành động đang xảy ra tại thời điểm nói. Do đó, cần sử dụng thì Hiện tại tiếp diễn (Present Continuous) để diễn tả hành động đang diễn ra.", translation: "Hành động 'đang chờ đợi' là một hành động diễn ra ngay tại thời điểm nói." },
            { id: 'ans10', original: 'does his homework', correct: 'is doing his homework', explanation: "Tương tự như 'wait', cụm từ 'Right now' ảnh hưởng đến cả câu sau. Hành động 'làm bài tập về nhà' đang diễn ra tại thời điểm nói, không phải một thói quen hay sự thật chung. Do đó, sử dụng thì Hiện tại tiếp diễn.", translation: "Hành động 'đang làm bài tập về nhà' là một hành động diễn ra ngay tại thời điểm nói." }
        ];

        // Function to render feedback and results
        function renderFeedback() {
            feedbackDiv.innerHTML = ''; // Clear previous feedback
            resultsDiv.style.display = 'block';

            let allCorrect = true;

            verbsData.forEach((verb, index) => {
                const inputElement = document.getElementById(verb.id);
                const userAnswer = inputElement.value.trim().toLowerCase();
                const correctAnswer = verb.correct.toLowerCase();

                let statusClass = '';
                let statusText = '';

                if (userAnswer === correctAnswer) {
                    statusClass = 'correct-answer';
                    statusText = '✓ Đúng!';
                } else {
                    statusClass = 'incorrect-answer';
                    statusText = '✗ Sai!';
                    allCorrect = false;
                }

                feedbackDiv.innerHTML += `
                    <div class="mb-3">
                        <p><strong>${index + 1}.</strong> <span class="${statusClass}">${statusText}</span></p>
                        <p class="mb-1"><strong>Câu gốc (động từ gạch chân):</strong> "${verb.original}"</p>
                        <p class="mb-1"><strong>Đáp án của bạn:</strong> "${userAnswer}"</p>
                        <p class="mb-1"><strong>Đáp án đúng:</strong> <span id="correctAnsDisplay${index}">${verb.correct}</span></p>
                        <p class="explanation" id="explanationDisplay${index}"><strong>Giải thích:</strong> ${verb.explanation}</p>
                        <p class="vietnamese-translation" id="translationDisplay${index}"><strong>Dịch nghĩa:</strong> ${verb.translation}</p>
                        <button class="btn btn-sm btn-info mt-2" onclick="toggleEdit(${index})">Chỉnh sửa đáp án/giải thích</button>
                        <div class="edit-area" id="editArea${index}">
                            <label for="editCorrect${index}" class="form-label">Đáp án đúng:</label>
                            <input type="text" class="form-control" id="editCorrect${index}" value="${verb.correct}">
                            <label for="editExplanation${index}" class="form-label mt-2">Giải thích:</label>
                            <textarea class="form-control" id="editExplanation${index}">${verb.explanation}</textarea>
                            <label for="editTranslation${index}" class="form-label mt-2">Dịch nghĩa:</label>
                            <textarea class="form-control" id="editTranslation${index}">${verb.translation}</textarea>
                            <button class="btn btn-sm btn-success mt-2" onclick="saveEdit(${index})">Lưu thay đổi</button>
                        </div>
                    </div>
                    <hr>
                `;
            });

            if (allCorrect) {
                feedbackDiv.innerHTML = `<div class="alert alert-success text-center">Chúc mừng! Bạn đã hoàn thành xuất sắc bài tập!</div>` + feedbackDiv.innerHTML;
            } else {
                feedbackDiv.innerHTML = `<div class="alert alert-warning text-center">Bạn chưa đúng hết. Hãy xem lại các lỗi sai bên dưới!</div>` + feedbackDiv.innerHTML;
            }
        }

        // Function to toggle edit area
        window.toggleEdit = function(index) {
            const editArea = document.getElementById(`editArea${index}`);
            if (editArea.style.display === 'block') {
                editArea.style.display = 'none';
            } else {
                editArea.style.display = 'block';
            }
        };

        // Function to save edited data
        window.saveEdit = function(index) {
            const editCorrect = document.getElementById(`editCorrect${index}`).value;
            const editExplanation = document.getElementById(`editExplanation${index}`).value;
            const editTranslation = document.getElementById(`editTranslation${index}`).value;

            verbsData[index].correct = editCorrect;
            verbsData[index].explanation = editExplanation;
            verbsData[index].translation = editTranslation;

            // Update displayed text immediately
            document.getElementById(`correctAnsDisplay${index}`).innerText = editCorrect;
            document.getElementById(`explanationDisplay${index}`).innerHTML = `<strong>Giải thích:</strong> ${editExplanation}`;
            document.getElementById(`translationDisplay${index}`).innerHTML = `<strong>Dịch nghĩa:</strong> ${editTranslation}`;

            // Hide the edit area
            document.getElementById(`editArea${index}`).style.display = 'none';
            alert('Đã lưu thay đổi!');
        };


        // Event listener for form submission
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            renderFeedback(); // Call the function to display feedback
        });

        // Event listener for reset button
        resetBtn.addEventListener('click', function() {
            form.reset();
            resultsDiv.style.display = 'none';
            feedbackDiv.innerHTML = '';
            // Reset highlights if any
            document.querySelectorAll('.highlight-verb').forEach(span => {
                span.style.backgroundColor = ''; // Remove highlight
            });
            // Re-highlight the original text after reset, if needed.
            // (The initial highlight logic is already in DOMContentLoaded)
        });

        // Initial highlighting for the exercise text
        document.addEventListener('DOMContentLoaded', () => {
            const exerciseTextElement = document.querySelector('.exercise-text');
            let originalText = exerciseTextElement.innerHTML; // Store original content

            // Highlight each original verb using its 'data-original-verb' attribute
            verbsData.forEach(verb => {
                const regex = new RegExp(`(?<!<span class="highlight-verb" data-original-verb="${verb.original}">)\\b${verb.original.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\b`, 'g');
                // Use a negative lookbehind to avoid re-wrapping already wrapped spans.
                // This is a bit complex for simple regex. A safer way is to iterate DOM nodes.

                // A simpler, safer way to apply highlighting *after* the DOM is loaded:
                // Find all text nodes and replace.
                // Or, use the pre-defined spans with data attributes and apply CSS.
                // I've updated the HTML directly to use `data-original-verb` and a common class for easier selection.
            });
            // The spans with `highlight-verb` and `data-original-verb` are already in the HTML.
            // No need to dynamically replace, just ensure they are styled if needed.
            // For now, no specific styling applied to `highlight-verb` in CSS, but you can add it.
        });
    </script>
</body>
</html>
            