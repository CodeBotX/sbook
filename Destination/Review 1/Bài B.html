<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phrasal Verbs Exercise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif; /* Using Open Sans font as per the provided template */
            background-color: #f0f2f5; /* Light grey background */
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Enhanced shadow */
        }

        /* Headings */
        h1 {
            color: #2c3e50; /* Darker blue for headings */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700; /* Bolder headings */
        }
        h2 {
            color: #2c3e50; /* Darker blue for sub-headings */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9; /* Light green background for instructions */
            border-left: 6px solid #4CAF50; /* Green border */
            padding: 20px 25px;
            border-radius: 10px; /* Rounded corners */
            color: #388e3c; /* Darker green text */
        }

        /* Styling for the verb box */
        .verb-box {
            background-color: #e0f2f7; /* Light blue background */
            border: 1px solid #b3e0f2;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 600;
            color: #01579b;
        }
        .verb-box span {
            margin: 0 8px;
            display: inline-block; /* Ensure spacing */
        }
        .verb-box span::after {
            content: ' •'; /* Bullet separator */
            color: #01579b;
        }
        .verb-box span:last-child::after {
            content: ''; /* No bullet after the last word */
        }


        /* Styling for each exercise item (question line) */
        .exercise-item {
            margin-bottom: 20px;
            display: flex;
            align-items: baseline; /* Align text baselines */
            font-size: 1.05em;
            color: #34495e;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .exercise-item .form-label {
            margin-right: 15px;
            font-weight: 600;
            color: #2c3e50;
            width: 30px; /* Numbering width */
            text-align: right;
            flex-shrink: 0; /* Prevent shrinking of question number */
        }
        .exercise-item .text-segment {
            margin-right: 5px;
            display: inline; /* Keep text parts inline */
            white-space: pre-wrap; /* Allow text to wrap naturally */
        }
        .exercise-item .answer-input {
            flex-grow: 1; /* Allow input to grow and fill space */
            min-width: 120px; /* Minimum width for input */
            max-width: 250px; /* Max width to prevent overly long inputs */
            padding: 8px 12px;
            border-radius: 8px; /* Rounded input fields */
            border: 1px solid #ced4da;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            margin-bottom: 5px; /* Space if input wraps below text */
        }
        .exercise-item .answer-input:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        /* Feedback borders for inputs */
        .exercise-item .answer-input.is-valid {
            border-color: #198754 !important;
            box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25) !important;
            background-color: #d1e7dd;
            color: #0f5132;
        }
        .exercise-item .answer-input.is-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
            background-color: #f8d7da;
            color: #842029;
        }

        /* Feedback icons (check/cross) */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            flex-shrink: 0; /* Prevent shrinking of icon */
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .question-text {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .verb-box {
                font-size: 1em;
                padding: 10px 15px;
            }
            .verb-box span {
                margin: 0 5px;
            }
            .exercise-item {
                flex-direction: column; /* Stack elements vertically */
                align-items: flex-start;
            }
            .exercise-item .form-label {
                margin-right: 0;
                margin-bottom: 5px;
                width: auto; /* Allow width to be auto */
            }
            .exercise-item .text-segment {
                margin-right: 0;
                margin-bottom: 5px;
            }
            .exercise-item .answer-input {
                width: 100%; /* Full width input on small screens */
                max-width: 100%; /* Ensure it doesn't exceed container */
                margin-bottom: 10px;
            }
            .feedback-icon {
                margin-left: 0;
                margin-top: 5px;
            }
            .buttons .btn {
                font-size: 1.1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.3em;
                padding: 12px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Cụm Động Từ</h1>
        </div>
        <h2>Complete using the correct form of the verbs in the box.</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Complete using the correct form of the verbs in the box. You have to use one word twice.
            <br>
            <strong>Hướng dẫn:</strong> Hoàn thành bằng cách sử dụng dạng đúng của các động từ trong hộp. Bạn phải sử dụng một từ hai lần.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <div class="verb-box">
            <span>carry</span><span>eat</span><span>give</span><span>join</span><span>send</span><span>take</span><span>turn</span>
        </div>

        <form id="phrasalVerbForm">
            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q9" class="form-label">9</label>
                    <span class="text-segment">Now, everyone knows this song, so I want you all to</span>
                    <input type="text" class="form-control answer-input" id="q9" name="q9">
                    <span class="text-segment">in with me!</span>
                    <i class="feedback-icon fa-solid" id="icon9"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q10" class="form-label">10</label>
                    <span class="text-segment">It's so noisy in this restaurant. Could you ask them to</span>
                    <input type="text" class="form-control answer-input" id="q10" name="q10">
                    <span class="text-segment">the music down?</span>
                    <i class="feedback-icon fa-solid" id="icon10"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q11" class="form-label">11</label>
                    <span class="text-segment">There was a fight during the match and the referee</span>
                    <input type="text" class="form-control answer-input" id="q11" name="q11">
                    <span class="text-segment">two players off.</span>
                    <i class="feedback-icon fa-solid" id="icon11"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q12" class="form-label">12</label>
                    <span class="text-segment">We</span>
                    <input type="text" class="form-control answer-input" id="q12" name="q12">
                    <span class="text-segment">out about once a week and we cook at home the rest of the time.</span>
                    <i class="feedback-icon fa-solid" id="icon12"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q13" class="form-label">13</label>
                    <span class="text-segment">I love this song!</span>
                    <input type="text" class="form-control answer-input" id="q13" name="q13">
                    <span class="text-segment">it up!</span>
                    <i class="feedback-icon fa-solid" id="icon13"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q14" class="form-label">14</label>
                    <span class="text-segment">I used to play the trumpet, but I</span>
                    <input type="text" class="form-control answer-input" id="q14" name="q14">
                    <span class="text-segment">up last year because I didn't have time.</span>
                    <i class="feedback-icon fa-solid" id="icon14"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q15" class="form-label">15</label>
                    <span class="text-segment">We stopped playing because of the rain, but when it stopped we</span>
                    <input type="text" class="form-control answer-input" id="q15" name="q15">
                    <span class="text-segment">on.</span>
                    <i class="feedback-icon fa-solid" id="icon15"></i>
                </div>
            </div>

            <div class="mb-4">
                <div class="exercise-item">
                    <label for="q16" class="form-label">16</label>
                    <span class="text-segment">A good way of getting more exercise is to</span>
                    <input type="text" class="form-control answer-input" id="q16" name="q16">
                    <span class="text-segment">up a sport, like basketball.</span>
                    <i class="feedback-icon fa-solid" id="icon16"></i>
                </div>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, original text templates, translations, and explanations
        const correctAnswers = {
            'q9': {
                answer: ['join'],
                originalText: 'Now, everyone knows this song, so I want you all to {answer} in with me!',
                translation: 'Bây giờ, mọi người đều biết bài hát này, vì vậy tôi muốn tất cả các bạn cùng hát với tôi!',
                explanation: '"Join in" (tham gia vào) là một cụm động từ có nghĩa là tham gia vào một hoạt động mà người khác đang làm.',
                grammar_note: 'Dạng nguyên mẫu của động từ "join" được sử dụng sau "to".'
            },
            'q10': {
                answer: ['turn'],
                originalText: 'It\'s so noisy in this restaurant. Could you ask them to {answer} the music down?',
                translation: 'Nhà hàng này ồn ào quá. Bạn có thể yêu cầu họ vặn nhỏ nhạc lại không?',
                explanation: '"Turn down" (vặn nhỏ) là một cụm động từ có nghĩa là giảm âm lượng, nhiệt độ, v.v. của một thứ gì đó.',
                grammar_note: 'Dạng nguyên mẫu của động từ "turn" được sử dụng sau "to".'
            },
            'q11': {
                answer: ['sent'],
                originalText: 'There was a fight during the match and the referee {answer} two players off.',
                translation: 'Đã có một cuộc ẩu đả trong trận đấu và trọng tài đã đuổi hai cầu thủ ra khỏi sân.',
                explanation: '"Send off" (đuổi ra) là một cụm động từ được sử dụng khi trọng tài yêu cầu một cầu thủ rời sân vì vi phạm luật. Cần sử dụng thì quá khứ đơn.',
                grammar_note: 'Dạng quá khứ đơn của động từ "send" là "sent".'
            },
            'q12': {
                answer: ['eat'],
                originalText: 'We {answer} out about once a week and we cook at home the rest of the time.',
                translation: 'Chúng tôi đi ăn ngoài khoảng một lần một tuần và chúng tôi nấu ăn ở nhà trong thời gian còn lại.',
                explanation: '"Eat out" (ăn ngoài) là một cụm động từ có nghĩa là ăn ở nhà hàng, thay vì ở nhà.',
                grammar_note: 'Dạng nguyên mẫu của động từ "eat" được sử dụng ở thì hiện tại đơn để diễn tả thói quen.'
            },
            'q13': {
                answer: ['Turn'],
                originalText: 'I love this song! {answer} it up!',
                translation: 'Tôi yêu bài hát này! Bật nó lên đi!',
                explanation: '"Turn up" (bật lên) là một cụm động từ có nghĩa là tăng âm lượng, nhiệt độ, v.v. của một thứ gì đó.',
                grammar_note: 'Dạng nguyên mẫu của động từ "Turn" được sử dụng trong câu mệnh lệnh.'
            },
            'q14': {
                answer: ['gave'],
                originalText: 'I used to play the trumpet, but I {answer} up last year because I didn\'t have time.',
                translation: 'Tôi đã từng chơi kèn trumpet, nhưng tôi đã bỏ cuộc vào năm ngoái vì tôi không có thời gian.',
                explanation: '"Give up" (bỏ cuộc) là một cụm động từ có nghĩa là ngừng làm điều gì đó mà bạn thường xuyên làm. Cần sử dụng thì quá khứ đơn.',
                grammar_note: 'Dạng quá khứ đơn của động từ "give" là "gave".'
            },
            'q15': {
                answer: ['carried'],
                originalText: 'We stopped playing because of the rain, but when it stopped we {answer} on.',
                translation: 'Chúng tôi đã ngừng chơi vì trời mưa, nhưng khi trời tạnh, chúng tôi tiếp tục.',
                explanation: '"Carry on" (tiếp tục) là một cụm động từ có nghĩa là tiếp tục làm điều gì đó. Cần sử dụng thì quá khứ đơn.',
                grammar_note: 'Dạng quá khứ đơn của động từ "carry" là "carried".'
            },
            'q16': {
                answer: ['take'],
                originalText: 'A good way of getting more exercise is to {answer} up a sport, like basketball.',
                translation: 'Một cách tốt để tập thể dục nhiều hơn là bắt đầu một môn thể thao, như bóng rổ.',
                explanation: '"Take up" (bắt đầu) là một cụm động từ có nghĩa là bắt đầu một sở thích, môn thể thao hoặc hoạt động khác.',
                grammar_note: 'Dạng nguyên mẫu của động từ "take" được sử dụng sau "to".'
            }
        };

        /**
         * Normalizes a string by converting to lowercase, trimming whitespace,
         * and replacing multiple spaces with a single space.
         * @param {string} answer - The string to normalize.
         * @returns {string} The normalized string.
         */
        function normalizeAnswer(answer) {
            return answer.toLowerCase().replace(/\s+/g, ' ').trim();
        }

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(correctAnswers).length; // Total questions based on correctAnswers object

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question in the correctAnswers object
            Object.keys(correctAnswers).forEach(qId => {
                const inputElement = document.getElementById(qId);
                // If input element doesn't exist, skip (shouldn't happen with correct IDs)
                if (!inputElement) return;

                const userAnswer = normalizeAnswer(inputElement.value);
                const correctInfo = correctAnswers[qId];
                // Find the feedback icon associated with this input
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`); // Get icon by ID (e.g., icon9 for q9)

                // Clear previous feedback classes and hide icon
                inputElement.classList.remove('is-valid', 'is-invalid');
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    feedbackIcon.style.display = 'none'; // Hide icon initially
                }

                // Check if the user's answer is correct
                const isCorrect = correctInfo.answer.some(ans => normalizeAnswer(ans) === userAnswer);

                if (isCorrect) {
                    score++;
                    inputElement.classList.add('is-valid');
                    if (feedbackIcon) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    }
                } else {
                    inputElement.classList.add('is-invalid');
                    if (feedbackIcon) {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                }

                // Always show the feedback icon after checking
                if (feedbackIcon) {
                    feedbackIcon.style.display = 'inline-block';
                }

                // Add detailed solution for each question
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1); // Extract number from q9, q10, etc.
                const questionTextDiv = document.createElement('div');
                questionTextDiv.classList.add('question-text');

                // Construct the full sentence with the correct answer highlighted
                let fullSentenceHtml = `<label class="form-label">${questionNumber}</label>. `;
                fullSentenceHtml += correctInfo.originalText.replace('{answer}', `<span class="correct-answer-text">${correctInfo.answer[0]}</span>`);
                questionTextDiv.innerHTML = fullSentenceHtml;
                solutionItem.appendChild(questionTextDiv);

                // Add explanation and translation
                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${correctInfo.explanation}<br>${correctInfo.grammar_note}`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch:</strong> ${correctInfo.translation}`;
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing inputs, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const inputs = document.querySelectorAll('.answer-input');
            inputs.forEach(input => {
                input.value = ''; // Clear input value
                input.classList.remove('is-valid', 'is-invalid'); // Remove feedback classes
                const feedbackIcon = document.getElementById(`icon${input.id.substring(1)}`); // Get icon by ID
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    feedbackIcon.style.display = 'none'; // Hide feedback icon
                }
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>
