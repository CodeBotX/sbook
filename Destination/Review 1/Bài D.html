<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple Choice Exercise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* General body styling */
        body {
            font-family: 'Open Sans', sans-serif; /* Using Open Sans font as per the provided template */
            background-color: #f0f2f5; /* Light grey background */
            line-height: 1.6;
            color: #333;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Main container for the exercise */
        .container-main {
            max-width: 900px;
            margin-top: 40px;
            margin-bottom: 40px;
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 15px; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Enhanced shadow */
        }

        /* Headings */
        h1 {
            color: #2c3e50; /* Darker blue for headings */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700; /* Bolder headings */
        }
        h2 {
            color: #2c3e50; /* Darker blue for sub-headings */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Instruction section styling */
        .instruction {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            text-align: center;
            line-height: 1.5;
            background-color: #e8f5e9; /* Light green background for instructions */
            border-left: 6px solid #4CAF50; /* Green border */
            padding: 20px 25px;
            border-radius: 10px; /* Rounded corners */
            color: #388e3c; /* Darker green text */
        }

        /* Styling for each exercise question */
        .question-item {
            margin-bottom: 30px; /* Increased margin for better separation */
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .question-item .question-text {
            font-size: 1.1em;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 15px;
        }
        .question-item .form-check {
            margin-bottom: 10px;
            padding-left: 2.5em; /* Space for custom radio button */
        }
        .question-item .form-check-input {
            margin-top: 0.3em;
            margin-left: -1.5em;
        }
        .question-item .form-check-label {
            font-size: 1em;
            color: #555;
            cursor: pointer;
        }
        .question-item .form-check-label:hover {
            color: #007bff;
        }

        /* Feedback icons */
        .feedback-icon {
            margin-left: 10px;
            font-size: 1.2em;
            display: none; /* Hidden by default, shown by JS */
            vertical-align: middle;
        }
        .feedback-icon.text-success { color: #198754; }
        .feedback-icon.text-danger { color: #dc3545; }

        /* Buttons styling */
        .buttons .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 15px;
            border-radius: 30px; /* Pill-shaped buttons */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Score display styling */
        .score-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #007bff;
            margin-top: 30px;
            margin-bottom: 25px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            display: none; /* Hidden by default */
        }
        .score-display.text-success { background-color: #d1e7dd; border-color: #a3cfb4; color: #198754; }
        .score-display.text-warning { background-color: #fff3cd; border-color: #ffeeba; color: #ffc107; }
        .score-display.text-danger { background-color: #f8d7da; border-color: #f5c2c7; color: #dc3545; }

        /* Detailed solution section styling */
        .solution-section {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ced4da;
            display: none; /* Hidden by default */
        }
        .solution-section h2 {
            color: #007bff;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }
        .solution-list .solution-item {
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .solution-list .solution-item .question-text-solution {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        .solution-list .solution-item .correct-answer-text {
            font-weight: 700;
            color: #198754;
            text-decoration: underline;
            margin-right: 5px;
        }
        .solution-list .solution-item .grammar-explanation {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #6c757d;
        }
        .solution-list .solution-item .translation {
            font-style: italic;
            color: #6c757d;
            font-size: 0.95em;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container-main {
                padding: 25px;
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            .instruction {
                font-size: 0.95em;
                padding: 15px;
            }
            .question-item {
                padding: 15px;
                margin-bottom: 20px;
            }
            .question-item .question-text {
                font-size: 1em;
                margin-bottom: 10px;
            }
            .question-item .form-check-label {
                font-size: 0.95em;
            }
            .buttons .btn {
                font-size: 1.1em;
                padding: 10px 25px;
                margin: 0 8px;
            }
            .score-display {
                font-size: 1.3em;
                padding: 12px;
            }
            .solution-list .solution-item {
                padding: 10px 15px;
            }
            .solution-list .solution-item .grammar-explanation,
            .solution-list .solution-item .translation {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <div class="d-flex align-items-center justify-content-center mb-4">
            <h1>Bài Tập Trắc Nghiệm</h1>
        </div>
        <h2>Chọn đáp án đúng nhất</h2>
        <p class="instruction">
            <strong>Instructions:</strong> Choose the correct answer.
            <br>
            <strong>Hướng dẫn:</strong> Chọn đáp án đúng nhất.
            <br>
            <span class="text-muted">(Lưu ý: Đáp án và lời giải chi tiết sẽ hiển thị sau khi bạn nhấn "Kiểm tra".)</span>
        </p>

        <form id="multipleChoiceForm">
            <div class="question-item">
                <p class="question-text">27. When you rang, I .................... my bike.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q27" id="q27_a" value="A">
                    <label class="form-check-label" for="q27_a">A cleaned</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q27" id="q27_b" value="B">
                    <label class="form-check-label" for="q27_b">B was cleaning</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q27" id="q27_c" value="C">
                    <label class="form-check-label" for="q27_c">C used to clean</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q27" id="q27_d" value="D">
                    <label class="form-check-label" for="q27_d">D clean</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon27"></i>
            </div>

            <div class="question-item">
                <p class="question-text">28. At my last basketball club, we .................... every Saturday for three hours.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q28" id="q28_a" value="A">
                    <label class="form-check-label" for="q28_a">A were training</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q28" id="q28_b" value="B">
                    <label class="form-check-label" for="q28_b">B training</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q28" id="q28_c" value="C">
                    <label class="form-check-label" for="q28_c">C train</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q28" id="q28_d" value="D">
                    <label class="form-check-label" for="q28_d">D used to train</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon28"></i>
            </div>

            <div class="question-item">
                <p class="question-text">29. I really .................... the meal we had at your house last Tuesday.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q29" id="q29_a" value="A">
                    <label class="form-check-label" for="q29_a">A was liking</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q29" id="q29_b" value="B">
                    <label class="form-check-label" for="q29_b">B liked</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q29" id="q29_c" value="C">
                    <label class="form-check-label" for="q29_c">C like</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q29" id="q29_d" value="D">
                    <label class="form-check-label" for="q29_d">D am liking</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon29"></i>
            </div>

            <div class="question-item">
                <p class="question-text">30. We .................... to the beach every day when we were on holiday.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q30" id="q30_a" value="A">
                    <label class="form-check-label" for="q30_a">A went</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q30" id="q30_b" value="B">
                    <label class="form-check-label" for="q30_b">B were going</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q30" id="q30_c" value="C">
                    <label class="form-check-label" for="q30_c">C go</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q30" id="q30_d" value="D">
                    <label class="form-check-label" for="q30_d">D used to going</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon30"></i>
            </div>

            <div class="question-item">
                <p class="question-text">31. I broke my leg when Tony and I .................... for the school sports day.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q31" id="q31_a" value="A">
                    <label class="form-check-label" for="q31_a">A practised</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q31" id="q31_b" value="B">
                    <label class="form-check-label" for="q31_b">B used to practise</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q31" id="q31_c" value="C">
                    <label class="form-check-label" for="q31_c">C were practising</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q31" id="q31_d" value="D">
                    <label class="form-check-label" for="q31_d">D are practising</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon31"></i>
            </div>

            <div class="question-item">
                <p class="question-text">32. Leon never .................... about it, but he was once a world champion skier.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q32" id="q32_a" value="A">
                    <label class="form-check-label" for="q32_a">A talks</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q32" id="q32_b" value="B">
                    <label class="form-check-label" for="q32_b">B is talking</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q32" id="q32_c" value="C">
                    <label class="form-check-label" for="q32_c">C was talking</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q32" id="q32_d" value="D">
                    <label class="form-check-label" for="q32_d">D talk</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon32"></i>
            </div>

            <div class="question-item">
                <p class="question-text">33. I .................... like golf, but now I really like it.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q33" id="q33_a" value="A">
                    <label class="form-check-label" for="q33_a">A don't use to</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q33" id="q33_b" value="B">
                    <label class="form-check-label" for="q33_b">B don't used to</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q33" id="q33_c" value="C">
                    <label class="form-check-label" for="q33_c">C didn't used to</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q33" id="q33_d" value="D">
                    <label class="form-check-label" for="q33_d">D didn't use to</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon33"></i>
            </div>

            <div class="question-item">
                <p class="question-text">34. Denise .................... at the stadium until she finds a better job.</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q34" id="q34_a" value="A">
                    <label class="form-check-label" for="q34_a">A works</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q34" id="q34_b" value="B">
                    <label class="form-check-label" for="q34_b">B is working</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q34" id="q34_c" value="C">
                    <label class="form-check-label" for="q34_c">C used to work</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q34" id="q34_d" value="D">
                    <label class="form-check-label" for="q34_d">D was working</label>
                </div>
                <i class="feedback-icon fa-solid" id="icon34"></i>
            </div>

            <div class="buttons text-center mt-5">
                <button type="button" class="btn btn-primary me-3" onclick="submitAnswers()">Kiểm tra</button>
                <button type="button" class="btn btn-secondary" onclick="resetExercise()">Làm lại</button>
            </div>
        </form>

        <div id="scoreDisplay" class="score-display mt-4"></div>

        <div class="solution-section" id="detailedSolution">
            <h2>Lời giải chi tiết và Giải thích</h2>
            <div class="solution-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // Define correct answers, original text, options, explanations, and translations
        const questionsData = {
            'q27': {
                text: 'When you rang, I .................... my bike.',
                options: {
                    'A': 'cleaned',
                    'B': 'was cleaning',
                    'C': 'used to clean',
                    'D': 'clean'
                },
                correct: 'B',
                translation: 'Khi bạn gọi điện, tôi đang lau xe đạp của mình.',
                explanation: 'Đây là hành động đang diễn ra trong quá khứ thì bị một hành động khác (gọi điện) cắt ngang. "When you rang" chỉ một thời điểm cụ thể trong quá khứ, và "was cleaning" thể hiện hành động đang diễn ra.',
                grammar_note: 'Thì Quá khứ Tiếp diễn (Past Continuous) dùng cho hành động đang diễn ra bị một hành động khác ở thì Quá khứ Đơn (Simple Past) cắt ngang.'
            },
            'q28': {
                text: 'At my last basketball club, we .................... every Saturday for three hours.',
                options: {
                    'A': 'were training',
                    'B': 'training',
                    'C': 'train',
                    'D': 'used to train'
                },
                correct: 'D',
                translation: 'Ở câu lạc bộ bóng rổ trước đây của tôi, chúng tôi đã từng tập luyện vào mỗi thứ Bảy trong ba giờ.',
                explanation: '"Every Saturday for three hours" chỉ một thói quen lặp đi lặp lại trong quá khứ mà hiện tại không còn nữa (ngụ ý bởi "At my last basketball club"). "Used to train" là cách diễn tả thói quen trong quá khứ phù hợp nhất.',
                grammar_note: 'Cấu trúc "used to + động từ nguyên mẫu" dùng để diễn tả thói quen hoặc tình trạng trong quá khứ.'
            },
            'q29': {
                text: 'I really .................... the meal we had at your house last Tuesday.',
                options: {
                    'A': 'was liking',
                    'B': 'liked',
                    'C': 'like',
                    'D': 'am liking'
                },
                correct: 'B',
                translation: 'Tôi thực sự thích bữa ăn chúng tôi đã có ở nhà bạn vào thứ Ba tuần trước.',
                explanation: '"Last Tuesday" chỉ rõ một thời điểm cụ thể trong quá khứ, vì vậy thì Quá khứ Đơn là phù hợp cho một hành động/cảm xúc đã hoàn thành. "Like" là một động từ trạng thái và thường không được dùng ở các thì tiếp diễn.',
                grammar_note: 'Sử dụng thì Quá khứ Đơn. Động từ trạng thái (stative verbs) thường không dùng ở thì tiếp diễn.'
            },
            'q30': {
                text: 'We .................... to the beach every day when we were on holiday.',
                options: {
                    'A': 'went',
                    'B': 'were going',
                    'C': 'go',
                    'D': 'used to going'
                },
                correct: 'A',
                translation: 'Chúng tôi đã đi biển mỗi ngày khi chúng tôi đi nghỉ.',
                explanation: '"Every day when we were on holiday" mô tả một hành động lặp đi lặp lại trong một giai đoạn trong quá khứ. Thì Quá khứ Đơn "went" phù hợp để diễn tả điều này. "Used to going" là sai ngữ pháp.',
                grammar_note: 'Thì Quá khứ Đơn dùng cho các hành động lặp đi lặp lại trong quá khứ. Lưu ý "used to + V" là đúng, còn "used to going" là sai.'
            },
            'q31': {
                text: 'I broke my leg when Tony and I .................... for the school sports day.',
                options: {
                    'A': 'practised',
                    'B': 'used to practise',
                    'C': 'were practising',
                    'D': 'are practising'
                },
                correct: 'C',
                translation: 'Tôi bị gãy chân khi Tony và tôi đang tập luyện cho ngày hội thể thao của trường.',
                explanation: 'Đây là hành động đang diễn ra ("were practising") trong quá khứ thì bị một hành động khác ("broke my leg") cắt ngang.',
                grammar_note: 'Thì Quá khứ Tiếp diễn dùng cho hành động đang diễn ra bị một hành động khác ở thì Quá khứ Đơn cắt ngang.'
            },
            'q32': {
                text: 'Leon never .................... about it, but he was once a world champion skier.',
                options: {
                    'A': 'talks',
                    'B': 'is talking',
                    'C': 'was talking',
                    'D': 'talk'
                },
                correct: 'A',
                translation: 'Leon không bao giờ nói về điều đó, nhưng anh ấy đã từng là một nhà vô địch trượt tuyết thế giới.',
                explanation: '"Never talks" chỉ một thói quen hoặc sự thật chung ở hiện tại. Mặc dù vế sau của câu nói về quá khứ, vế đầu tiên mô tả thói quen hiện tại của anh ấy là không bao giờ nói về điều đó.',
                grammar_note: 'Thì Hiện tại Đơn (Simple Present) dùng cho thói quen hoặc sự thật chung.'
            },
            'q33': {
                text: 'I .................... like golf, but now I really like it.',
                options: {
                    'A': 'don\'t use to',
                    'B': 'don\'t used to',
                    'C': 'didn\'t used to',
                    'D': 'didn\'t use to'
                },
                correct: 'D',
                translation: 'Tôi đã từng không thích golf, nhưng bây giờ tôi thực sự thích nó.',
                explanation: 'Cụm từ "but now I really like it" cho thấy sự thay đổi từ một trạng thái trong quá khứ. "Didn\'t use to" là dạng phủ định đúng của "used to" để diễn tả một thói quen hoặc trạng thái trong quá khứ không còn tồn tại. Các lựa chọn A, B, C là sai ngữ pháp.',
                grammar_note: 'Dạng phủ định của "used to" là "didn\'t use to + động từ nguyên mẫu".'
            },
            'q34': {
                text: 'Denise .................... at the stadium until she finds a better job.',
                options: {
                    'A': 'works',
                    'B': 'is working',
                    'C': 'used to work',
                    'D': 'was working'
                },
                correct: 'B',
                translation: 'Denise đang làm việc tại sân vận động cho đến khi cô ấy tìm được một công việc tốt hơn.',
                explanation: '"Until she finds a better job" ngụ ý một tình huống tạm thời ở hiện tại sẽ tiếp tục cho đến một sự kiện trong tương lai. "Is working" (Thì Hiện tại Tiếp diễn) được dùng cho các hành động tạm thời đang diễn ra xung quanh thời điểm hiện tại.',
                grammar_note: 'Thì Hiện tại Tiếp diễn dùng cho các hành động tạm thời.'
            }
        };

        /**
         * Submits the user's answers, calculates the score, provides feedback,
         * and displays detailed solutions.
         */
        function submitAnswers() {
            let score = 0;
            const totalQuestions = Object.keys(questionsData).length;

            const solutionListDiv = document.querySelector('#detailedSolution .solution-list');
            solutionListDiv.innerHTML = ''; // Clear previous solutions
            document.getElementById('detailedSolution').style.display = 'block'; // Show solution section

            // Iterate through each question
            Object.keys(questionsData).forEach(qId => {
                const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                const questionInfo = questionsData[qId];
                const feedbackIcon = document.getElementById(`icon${qId.substring(1)}`); // e.g., icon27 for q27

                // Reset feedback
                document.querySelectorAll(`input[name="${qId}"]`).forEach(input => {
                    const label = input.nextElementSibling;
                    label.style.color = '#555'; // Reset label color
                });
                if (feedbackIcon) {
                    feedbackIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                    feedbackIcon.style.display = 'none';
                }

                let isCorrect = false;
                if (selectedOption) {
                    if (selectedOption.value === questionInfo.correct) {
                        isCorrect = true;
                        score++;
                        selectedOption.nextElementSibling.style.color = '#198754'; // Green for correct label
                    } else {
                        selectedOption.nextElementSibling.style.color = '#dc3545'; // Red for incorrect label
                    }
                }

                // Show feedback icon
                if (feedbackIcon) {
                    if (isCorrect) {
                        feedbackIcon.classList.add('fa-check-circle', 'text-success');
                    } else {
                        feedbackIcon.classList.add('fa-times-circle', 'text-danger');
                    }
                    feedbackIcon.style.display = 'inline-block';
                }

                // Highlight correct answer in options
                const correctOptionInput = document.getElementById(`${qId}_${questionInfo.correct.toLowerCase()}`);
                if (correctOptionInput) {
                    correctOptionInput.nextElementSibling.style.fontWeight = 'bold';
                    correctOptionInput.nextElementSibling.style.color = '#007bff'; // Blue for correct answer in options
                }

                // Add detailed solution
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item');

                const questionNumber = qId.substring(1);
                const questionTextSolutionDiv = document.createElement('div');
                questionTextSolutionDiv.classList.add('question-text-solution');
                questionTextSolutionDiv.innerHTML = `${questionNumber}. ${questionInfo.text.replace('.........', `<span class="correct-answer-text">${questionInfo.options[questionInfo.correct]}</span>`)}`;
                solutionItem.appendChild(questionTextSolutionDiv);

                const grammarExplanationDiv = document.createElement('div');
                grammarExplanationDiv.classList.add('grammar-explanation');
                grammarExplanationDiv.innerHTML = `<strong>Giải thích ngữ pháp & ngữ cảnh:</strong> ${questionInfo.explanation}<br>${questionInfo.grammar_note}`;
                solutionItem.appendChild(grammarExplanationDiv);

                const translationDiv = document.createElement('div');
                translationDiv.classList.add('translation');
                translationDiv.innerHTML = `<strong>Dịch:</strong> ${questionInfo.translation}`;
                solutionItem.appendChild(translationDiv);

                solutionListDiv.appendChild(solutionItem);
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = `Bạn đã đạt ${score} / ${totalQuestions} điểm.`;

            // Apply color coding to score display based on performance
            scoreDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            if (score === totalQuestions) {
                scoreDisplay.classList.add('text-success');
            } else if (score >= totalQuestions / 2) {
                scoreDisplay.classList.add('text-warning');
            } else {
                scoreDisplay.classList.add('text-danger');
            }
            scoreDisplay.style.display = 'block'; // Show the score display

            // Scroll to the score display
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Resets the exercise by clearing selections, hiding feedback, score, and solutions.
         */
        function resetExercise() {
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.checked = false; // Uncheck all radio buttons
                const label = radio.nextElementSibling;
                label.style.color = '#555'; // Reset label color
                label.style.fontWeight = 'normal'; // Reset font weight
            });

            const feedbackIcons = document.querySelectorAll('.feedback-icon');
            feedbackIcons.forEach(icon => {
                icon.classList.remove('fa-check-circle', 'fa-times-circle', 'text-success', 'text-danger');
                icon.style.display = 'none'; // Hide feedback icon
            });

            document.getElementById('scoreDisplay').textContent = ''; // Clear score text
            document.getElementById('scoreDisplay').style.display = 'none'; // Hide score display
            document.getElementById('detailedSolution').style.display = 'none'; // Hide solution section
            document.querySelector('#detailedSolution .solution-list').innerHTML = ''; // Clear solutions list
        }
    </script>
</body>
</html>
